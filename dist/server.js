"use strict";var d=(u,a)=>()=>(a||u((a={exports:{}}).exports,a),a.exports);var H=d(ie=>{"use strict";var Yr=ie&&ie.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();Object.defineProperty(ie,"__esModule",{value:!0});var Kr=function(u){Yr(a,u);function a(t){var i=u.call(this)||this;return i.isOperational=!0,i.message=t.message,i.statusCode=t.statusCode,i.errorCode=t.errorCode,i}return a}(Error);ie.default=Kr});var X=d(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});var Zr={DATABASE_HOST:process.env.DATABASE_HOST,DATABASE_PASSWORD:process.env.DATABASE_PASSWORD,DATABASE_NAME:process.env.DATABASE_NAME,DATABASE_USERNAME:process.env.DATABASE_USERNAME,MODE:process.env.MODE,SECRET:process.env.SECRET,EMAIL_RESEND_TOKEN:process.env.EMAIL_RESEND_TOKEN,EMAIL_RESEND:process.env.EMAIL_RESEND,PORT:process.env.PORT,API_PREFIX:process.env.API_PREFIX,IP:process.env.IP};Be.default=Zr});var Tt=d(q=>{"use strict";var zr=q&&q.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Qr=q&&q.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Rt=q&&q.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(q,"__esModule",{value:!0});var $r=Rt(H()),en=Rt(X()),tn=function(u,a,t,i){return zr(void 0,void 0,void 0,function(){return Qr(this,function(n){return Array.isArray(u)?(console.log(u),t.status(400).json({message:"the body is not correct",errors:u}),[2]):u instanceof $r.default?(u.isOperational=void 0,t.status(u.statusCode).json({error:u}),[2]):u instanceof Error?(t.status(400).json({message:u.message,error:en.default.MODE==="prod"?void 0:u}),[2]):(t.status(400).json({message:"error"}),[2])})})};q.default=tn});var x=d(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});var rn={USER_EMAIL_NOT_FOUND:{errorCode:"1001",statusCode:404,message:"email not found"},INCORRECT_PASSWORD:{errorCode:"1002",statusCode:400,message:"the provided password is incorrect"},USER_NOT_FOUND:{errorCode:"1003",statusCode:404,message:"user not found"},USER_DOES_NOT_HAVE_ACCESS:{errorCode:"1004",statusCode:401,message:"you can't still login, you need admin permission"},EMAIL_ALREADY_EXISTS:{errorCode:"1004",statusCode:400,message:"the provided email already exists"},JWT_NOT_PROVIDED:{errorCode:"2001",statusCode:400,message:"please, login"},UNAUTHORIZED:{errorCode:"2002",statusCode:401,message:"unauthorized access"},JWT_IS_EXPIRED:{errorCode:"2003",statusCode:400,message:"the provided jwt is expired, login again"}};Le.default=rn});var G=d(ue=>{"use strict";var At=ue&&ue.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ue,"__esModule",{value:!0});var nn=At(require("mysql2/promise")),ye=At(X()),un=nn.default.createPool({database:ye.default.DATABASE_NAME,user:ye.default.DATABASE_USERNAME,host:ye.default.DATABASE_HOST,password:ye.default.DATABASE_PASSWORD,waitForConnections:!0,connectionLimit:10,queueLimit:1});ue.default=un});var ae=d(W=>{"use strict";var we=W&&W.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},be=W&&W.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(W,"__esModule",{value:!0});var an=function(){function u(){}return u.prototype.findAll=function(){return we(this,void 0,void 0,function(){return be(this,function(a){throw new Error("method not implemented")})})},u.prototype.findById=function(a){return we(this,void 0,void 0,function(){return be(this,function(t){throw new Error("method not implemented")})})},u.prototype.save=function(a){return we(this,void 0,void 0,function(){return be(this,function(t){throw new Error("method not implemented")})})},u.prototype.update=function(a){return we(this,void 0,void 0,function(){return be(this,function(t){throw new Error("method not implemented")})})},u}();W.default=an});var We=d(v=>{"use strict";var on=v&&v.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),He=v&&v.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Ge=v&&v.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},sn=v&&v.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(v,"__esModule",{value:!0});v.UserRepository=void 0;var ln=sn(ae()),cn=function(u){on(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findByEmail=function(t){return He(this,void 0,void 0,function(){return Ge(this,function(i){throw new Error("method not implemented")})})},a.prototype.saveAdmin=function(t){return He(this,void 0,void 0,function(){return Ge(this,function(i){throw new Error("method not implemented")})})},a.prototype.toggleAccessUser=function(t,i){return He(this,void 0,void 0,function(){return Ge(this,function(n){throw new Error("method not implemented")})})},a}(ln.default);v.UserRepository=cn});var qt=d(m=>{"use strict";var fn=m&&m.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Y=m&&m.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},K=m&&m.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},dn=m&&m.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(m,"__esModule",{value:!0});var Z=dn(G()),hn=We(),_n=function(u){fn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return Y(this,void 0,void 0,function(){var t;return K(this,function(i){switch(i.label){case 0:return[4,Z.default.query("SELECT * FROM users")];case 1:return t=i.sent()[0],[2,t]}})})},a.prototype.findById=function(t){return Y(this,void 0,void 0,function(){var i;return K(this,function(n){switch(n.label){case 0:return[4,Z.default.query("SELECT * FROM users WHERE id = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.save=function(t){return Y(this,void 0,void 0,function(){var i;return K(this,function(n){switch(n.label){case 0:return[4,Z.default.query("INSERT INTO users (email, fullname, password, area, has_access, role) VALUES (?, ?, ?, ?, ?, ?)",[t.email,t.fullname,t.password,t.area,0,t.role])];case 1:return i=n.sent()[0],[2,{id:i.insertId,fullname:t.fullname,email:t.email,password:t.password,area:t.area}]}})})},a.prototype.findByEmail=function(t){return Y(this,void 0,void 0,function(){var i;return K(this,function(n){switch(n.label){case 0:return[4,Z.default.query("SELECT id, email, password, fullname, area, has_access, role FROM users WHERE email = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.saveAdmin=function(t){return Y(this,void 0,void 0,function(){var i;return K(this,function(n){switch(n.label){case 0:return[4,Z.default.query("INSERT INTO users (email, fullname, password, area, has_access, role) VALUES (?, ?, ?, ?, ?, ?)",[t.email,t.fullname,t.password,t.area,1,t.role])];case 1:return i=n.sent()[0],[2,{id:i.insertId,fullname:t.fullname,email:t.email,password:t.password,area:t.area}]}})})},a.prototype.toggleAccessUser=function(t,i){return Y(this,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,Z.default.query("UPDATE users SET has_access = ? WHERE id = ?",[Number(t),i])];case 1:return n=e.sent()[0],[2,{id:n.insertId}]}})})},a}(hn.UserRepository);m.default=_n});var V=d(g=>{"use strict";var vn=g&&g.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),z=g&&g.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Q=g&&g.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Xe=g&&g.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(g,"__esModule",{value:!0});var Ve=Xe(x()),yn=Xe(qt()),wn=We(),Je=Xe(H()),bn=function(u){vn(a,u);function a(t){var i=u.call(this)||this;return i.userRepository=t,i}return a.prototype.findAll=function(){return z(this,void 0,void 0,function(){var t;return Q(this,function(i){switch(i.label){case 0:return[4,this.userRepository.findAll()];case 1:return t=i.sent(),[2,t.map(function(n){return n.password=void 0,n})]}})})},a.prototype.save=function(t){return z(this,void 0,void 0,function(){return Q(this,function(i){return[2,this.userRepository.save(t).catch(function(n){if(n.code==="ER_DUP_ENTRY")throw new Je.default(Ve.default.EMAIL_ALREADY_EXISTS);return n})]})})},a.prototype.saveAdmin=function(t){return z(this,void 0,void 0,function(){return Q(this,function(i){return[2,this.userRepository.saveAdmin(t)]})})},a.prototype.findByEmail=function(t){return z(this,void 0,void 0,function(){var i;return Q(this,function(n){switch(n.label){case 0:return[4,this.userRepository.findByEmail(t)];case 1:if(i=n.sent(),!i)throw new Je.default(Ve.default.USER_EMAIL_NOT_FOUND);return[2,i]}})})},a.prototype.findById=function(t){return z(this,void 0,void 0,function(){var i;return Q(this,function(n){switch(n.label){case 0:return[4,this.userRepository.findById(t)];case 1:if(i=n.sent(),!i)throw new Je.default(Ve.default.USER_NOT_FOUND);return[2,i]}})})},a.prototype.toggleAccessUser=function(t,i){return z(this,void 0,void 0,function(){return Q(this,function(n){return[2,this.userRepository.toggleAccessUser(t,i)]})})},a}(wn.UserRepository),mn=new bn(new yn.default);g.default=mn});var J=d(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});var gn=require("express-validator"),pn=function(u){return function(a,t,i){var n=(0,gn.validationResult)(a);if(!n.isEmpty())return i(n.array());u(a,t,i).catch(function(e){i(e)})}};xe.default=pn});var Mt=d(D=>{"use strict";var me=D&&D.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ge=D&&D.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Dt=D&&D.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(D,"__esModule",{value:!0});var pe=Dt(V()),Ee=Dt(J()),En=function(){function u(){var a=this;this.findAll=(0,Ee.default)(function(t,i){return me(a,void 0,void 0,function(){var n;return ge(this,function(e){switch(e.label){case 0:return[4,pe.default.findAll()];case 1:return n=e.sent(),i.status(200).json({users:n.filter(function(o){return o.has_access})}),[2]}})})}),this.findAllNotifications=(0,Ee.default)(function(t,i){return me(a,void 0,void 0,function(){var n;return ge(this,function(e){switch(e.label){case 0:return[4,pe.default.findAll()];case 1:return n=e.sent(),i.status(200).json({users:n.filter(function(o){return!o.has_access})}),[2]}})})}),this.save=(0,Ee.default)(function(t,i){return me(a,void 0,void 0,function(){var n;return ge(this,function(e){switch(e.label){case 0:return[4,pe.default.save(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"user created successfully",user:n}),[2]}})})}),this.toggleAccessUser=(0,Ee.default)(function(t,i){return me(a,void 0,void 0,function(){var n,e,o;return ge(this,function(l){switch(l.label){case 0:return n=t.body,e=n.userId,o=n.access,[4,pe.default.toggleAccessUser(o,e)];case 1:return l.sent(),i.status(200).json({message:"updated user successfully"}),[2]}})})})}return u}(),Sn=new En;D.default=Sn});var Ke=d(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});var On={JWT_AUTH:"ola_auth_jwt"};Ye.default=On});var Qe=d(_=>{"use strict";var Ze=_&&_.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ze=_&&_.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},jt=_&&_.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(_,"__esModule",{value:!0});_.verifyTokenUser=_.verifyToken=_.createToken=void 0;var Ct=jt(require("jsonwebtoken")),Se=jt(X());function kn(u){return Ze(this,void 0,void 0,function(){return ze(this,function(a){if(!Se.default.SECRET)throw new Error("secret not provided");return[2,Ct.default.sign(u,Se.default.SECRET,{expiresIn:"1d"})]})})}_.createToken=kn;function It(u){return Ze(this,void 0,void 0,function(){return ze(this,function(a){if(!Se.default.SECRET)throw new Error("secret not provided");return[2,Ct.default.verify(u,Se.default.SECRET)]})})}_.verifyToken=It;function Rn(u){return Ze(this,void 0,void 0,function(){var a;return ze(this,function(t){switch(t.label){case 0:return[4,It(u)];case 1:return a=t.sent(),[2,a]}})})}_.verifyTokenUser=Rn});var Oe=d(M=>{"use strict";var Tn=M&&M.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},An=M&&M.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},oe=M&&M.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(M,"__esModule",{value:!0});var qn=oe(x()),Dn=oe(Ke()),Mn=oe(V()),jn=oe(J()),Cn=oe(H()),In=Qe(),Un=(0,jn.default)(function(u,a,t){return Tn(void 0,void 0,void 0,function(){var i,n,e;return An(this,function(o){switch(o.label){case 0:if(i=(e=u.cookies)===null||e===void 0?void 0:e[Dn.default.JWT_AUTH],!i)throw new Cn.default(qn.default.JWT_NOT_PROVIDED);return[4,(0,In.verifyTokenUser)(i)];case 1:return n=o.sent(),[4,Mn.default.findById(n.id)];case 2:return o.sent(),u.cookieJwt=i,u.decodedToken=n,t(),[2]}})})});M.default=Un});var $e=d(j=>{"use strict";var Nn=j&&j.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Pn=j&&j.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},ke=j&&j.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(j,"__esModule",{value:!0});var Fn=ke(x()),Bn=ke(V()),Ln=ke(J()),Hn=ke(H());function Gn(u){var a=this;return(0,Ln.default)(function(t,i,n){return Nn(a,void 0,void 0,function(){var e,o;return Pn(this,function(l){switch(l.label){case 0:return e=t.decodedToken,[4,Bn.default.findById(e?.id)];case 1:if(o=l.sent(),!u.includes(o?.role))throw new Hn.default(Fn.default.UNAUTHORIZED);return n(),[2]}})})})}j.default=Gn});var ee=d($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.Roles=$.UserArea=void 0;var Ut;(function(u){u.admin="admin",u.commercial="Asesor comercial",u.design="Dise\xF1o",u.communityManager="Community manager",u.photograph="Fot\xF3grafo",u.telemarketing="Telemarketing",u.secretary="secretar\xEDa"})(Ut||($.UserArea=Ut={}));var Nt;(function(u){u.admin="admin",u.user="user"})(Nt||($.Roles=Nt={}))});var Ft=d(se=>{"use strict";var et=se&&se.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(se,"__esModule",{value:!0});var Wn=require("express"),tt=et(Mt()),rt=et(Oe()),nt=et($e()),it=ee(),Pt=require("express-validator"),Re=(0,Wn.Router)();Re.route("/").get(rt.default,(0,nt.default)([it.Roles.admin]),tt.default.findAll);Re.route("/notifications").get(rt.default,(0,nt.default)([it.Roles.admin]),tt.default.findAllNotifications);Re.route("/toggle-access").post([(0,Pt.body)("userId").isNumeric(),(0,Pt.body)("access").isBoolean()],rt.default,(0,nt.default)([it.Roles.admin]),tt.default.toggleAccessUser);se.default=Re});var at=d(p=>{"use strict";var Bt=p&&p.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Lt=p&&p.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(p,"__esModule",{value:!0});p.crypPassword=p.comparePassword=void 0;var ut=require("bcrypt");function Vn(u,a){return Bt(this,void 0,void 0,function(){return Lt(this,function(t){return[2,(0,ut.compare)(u,a)]})})}p.comparePassword=Vn;function Ht(u){return Bt(this,void 0,void 0,function(){var a;return Lt(this,function(t){switch(t.label){case 0:return[4,(0,ut.genSalt)()];case 1:return a=t.sent(),[2,(0,ut.hash)(u,a)]}})})}p.crypPassword=Ht;p.default=Ht});var ot=d(E=>{"use strict";var Jn=E&&E.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Xn=E&&E.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},xn=E&&E.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Yn=E&&E.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(E,"__esModule",{value:!0});var Kn=Yn(ae()),Zn=function(u){Jn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.find=function(t){return Xn(this,void 0,void 0,function(){return xn(this,function(i){throw new Error("method not implemented")})})},a}(Kn.default);E.default=Zn});var Xt=d(S=>{"use strict";var zn=S&&S.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Gt=S&&S.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Wt=S&&S.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Jt=S&&S.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(S,"__esModule",{value:!0});var Vt=Jt(G()),Qn=Jt(ot()),$n=function(u){zn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.save=function(t){return Gt(this,void 0,void 0,function(){var i;return Wt(this,function(n){switch(n.label){case 0:return[4,Vt.default.query("INSERT INTO blacklist (token, user_id) VALUES (?, ?)",[t.token,t.user_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,token:t.token}]}})})},a.prototype.find=function(t){return Gt(this,void 0,void 0,function(){var i;return Wt(this,function(n){switch(n.label){case 0:return[4,Vt.default.query("SELECT * FROM blacklist WHERE user_id = ? AND token = ?",[t.user_id,t.token])];case 1:return i=n.sent()[0][0],[2,i]}})})},a}(Qn.default);S.default=$n});var Zt=d(O=>{"use strict";var ei=O&&O.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),xt=O&&O.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Yt=O&&O.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Kt=O&&O.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(O,"__esModule",{value:!0});var ti=Kt(ot()),ri=Kt(Xt()),ni=function(u){ei(a,u);function a(t){var i=u.call(this)||this;return i.blacklistRespository=t,i}return a.prototype.find=function(t){return xt(this,void 0,void 0,function(){var i;return Yt(this,function(n){return i=this.blacklistRespository.find(t),[2,i]})})},a.prototype.save=function(t){return xt(this,void 0,void 0,function(){return Yt(this,function(i){return[2,this.blacklistRespository.save(t)]})})},a}(ti.default),ii=new ni(new ri.default);O.default=ii});var er=d(h=>{"use strict";var ui=h&&h.__createBinding||(Object.create?function(u,a,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(a,t);(!n||("get"in n?!a.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return a[t]}}),Object.defineProperty(u,i,n)}:function(u,a,t,i){i===void 0&&(i=t),u[i]=a[t]}),ai=h&&h.__setModuleDefault||(Object.create?function(u,a){Object.defineProperty(u,"default",{enumerable:!0,value:a})}:function(u,a){u.default=a}),oi=h&&h.__importStar||function(u){if(u&&u.__esModule)return u;var a={};if(u!=null)for(var t in u)t!=="default"&&Object.prototype.hasOwnProperty.call(u,t)&&ui(a,u,t);return ai(a,u),a},st=h&&h.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},lt=h&&h.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Te=h&&h.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(h,"__esModule",{value:!0});var ct=Te(x()),si=ee(),zt=oi(at()),ft=Te(H()),Qt=Te(Zt()),$t=Te(V()),li=function(){function u(){}return u.prototype.signup=function(a){return st(this,void 0,void 0,function(){var t,i;return lt(this,function(n){switch(n.label){case 0:return t=a,[4,(0,zt.default)(a.password||"")];case 1:return t.password=n.sent(),a.role=si.Roles.user,[4,$t.default.save(a)];case 2:return i=n.sent(),[2,i]}})})},u.prototype.login=function(a){return st(this,void 0,void 0,function(){var t,i;return lt(this,function(n){switch(n.label){case 0:return[4,$t.default.findByEmail(a.email)];case 1:if(t=n.sent(),!t.has_access)throw new ft.default(ct.default.USER_DOES_NOT_HAVE_ACCESS);return[4,(0,zt.comparePassword)(a.password,t.password)];case 2:if(i=n.sent(),!i)throw new ft.default(ct.default.INCORRECT_PASSWORD);return t.password=void 0,[2,t]}})})},u.prototype.logout=function(a){return st(this,void 0,void 0,function(){var t;return lt(this,function(i){switch(i.label){case 0:return[4,Qt.default.find({user_id:a.user_id,token:a.token})];case 1:if(t=i.sent(),t)throw new ft.default(ct.default.JWT_IS_EXPIRED);return[4,Qt.default.save({user_id:a.user_id,token:a.token})];case 2:return i.sent(),[2]}})})},u}(),ci=new li;h.default=ci});var rr=d(y=>{"use strict";var fi=y&&y.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},di=y&&y.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},hi=y&&y.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(y,"__esModule",{value:!0});y.removeTokenCookie=y.createTokenCookie=void 0;var tr=hi(Ke()),_i=Qe(),dt=new Date;dt.setDate(dt.getDate()+1);var vi=new Date(0);function yi(u,a){return fi(this,void 0,void 0,function(){var t;return di(this,function(i){switch(i.label){case 0:return[4,(0,_i.createToken)(a)];case 1:return t=i.sent(),u.cookie(tr.default.JWT_AUTH,t,{httpOnly:!0,path:"/",expires:dt}),[2]}})})}y.createTokenCookie=yi;function wi(u){u.cookie(tr.default.JWT_AUTH,"",{httpOnly:!0,path:"/",expires:vi})}y.removeTokenCookie=wi});var nr=d(C=>{"use strict";var Ae=C&&C.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},qe=C&&C.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},le=C&&C.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(C,"__esModule",{value:!0});var bi=le(x()),ht=le(er()),mi=le(V()),De=le(J()),_t=rr(),gi=le(H()),pi=function(){function u(){var a=this;this.signup=(0,De.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n;return qe(this,function(e){switch(e.label){case 0:return[4,ht.default.signup(t.body)];case 1:return n=e.sent(),n.password=void 0,[4,(0,_t.createTokenCookie)(i,{id:n.id})];case 2:return e.sent(),i.status(200).json({message:"user created successfully",user:n}),[2]}})})}),this.login=(0,De.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n;return qe(this,function(e){switch(e.label){case 0:return[4,ht.default.login(t.body)];case 1:return n=e.sent(),[4,(0,_t.createTokenCookie)(i,{id:n.id})];case 2:return e.sent(),i.status(200).json({messsage:"user authenticated!",user:n}),[2]}})})}),this.logout=(0,De.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n,e;return qe(this,function(o){switch(o.label){case 0:return n=t.cookieJwt,e=t.decodedToken,[4,ht.default.logout({user_id:e.id,token:n})];case 1:return o.sent(),(0,_t.removeTokenCookie)(i),i.json({message:"you are logout!"}),[2]}})})}),this.athenticate=(0,De.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n,e;return qe(this,function(o){switch(o.label){case 0:return n=t.decodedToken,[4,mi.default.findById(n.id)];case 1:if(e=o.sent(),!e.has_access)throw new gi.default(bi.default.USER_DOES_NOT_HAVE_ACCESS);return e.password=void 0,i.status(200).json({message:"user authenticated",user:e}),[2]}})})})}return u}(),Ei=new pi;C.default=Ei});var ar=d(ce=>{"use strict";var ir=ce&&ce.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ce,"__esModule",{value:!0});var Si=require("express"),Me=ir(nr()),te=require("express-validator"),Oi=ee(),ur=ir(Oe()),fe=(0,Si.Router)();fe.route("/signup").post([(0,te.body)("fullname").isString(),(0,te.body)("email").isEmail(),(0,te.body)("password").isString(),(0,te.body)("area").isIn(Object.values(Oi.UserArea))],Me.default.signup);fe.route("/login").post([(0,te.body)("email").isEmail(),(0,te.body)("password").isString()],Me.default.login);fe.route("/me").get(ur.default,Me.default.athenticate);fe.route("/logout").get(ur.default,Me.default.logout);ce.default=fe});var vt=d(L=>{"use strict";var ki=L&&L.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ri=L&&L.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(L,"__esModule",{value:!0});L.FormRepository=void 0;var Ti=Ri(ae()),Ai=function(u){ki(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a}(Ti.default);L.FormRepository=Ai});var cr=d(w=>{"use strict";var qi=w&&w.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),or=w&&w.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},sr=w&&w.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Di=w&&w.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(w,"__esModule",{value:!0});w.MysqlFormRepository=void 0;var lr=Di(G()),Mi=vt(),ji=function(u){qi(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return or(this,void 0,void 0,function(){var t,i,n,e,o,l,c,r,s;return sr(this,function(f){switch(f.label){case 0:return[4,lr.default.query({sql:`SELECT form.*, form_group.*, field.*
        FROM form 
        LEFT JOIN form_group ON form_group.form_id=form.id
        LEFT JOIN field ON field.form_group_id=form_group.id`,nestTables:!0})];case 1:for(t=f.sent()[0],i=new Map,n=new Map,e=new Map,console.log(t),t.forEach(function(re){i.set(re.form.id,re.form)}),o=Array.from(i.values()),l=function(re){t.forEach(function(B){B.form_group.form_id===re.id&&n.set(B.form_group.id,B.form_group)});var ve=o.findIndex(function(B){return B.id===re.id});o[ve].form_groups=Array.from(n.values()),n.clear();for(var Jr=function(B){t.forEach(function(ne){ne.field.form_group_id===B.id&&e.set(ne.field.id,ne.field)});var xr=o[ve].form_groups.findIndex(function(ne){return ne.id===B.id});o[ve].form_groups[xr].fields=Array.from(e.values()),e.clear()},Fe=0,kt=o[ve].form_groups;Fe<kt.length;Fe++){var Xr=kt[Fe];Jr(Xr)}},c=0,r=o;c<r.length;c++)s=r[c],l(s);return[2,o]}})})},a.prototype.save=function(t){return or(this,void 0,void 0,function(){var i;return sr(this,function(n){switch(n.label){case 0:return[4,lr.default.query("INSERT INTO form (label) VALUES (?)",[t.label])];case 1:return i=n.sent()[0],[2,{id:i.insertId,label:t.label}]}})})},a}(Mi.FormRepository);w.MysqlFormRepository=ji});var hr=d(I=>{"use strict";var Ci=I&&I.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),fr=I&&I.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},dr=I&&I.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(I,"__esModule",{value:!0});var Ii=vt(),Ui=cr(),Ni=function(u){Ci(a,u);function a(t){var i=u.call(this)||this;return i.formRepository=t,i}return a.prototype.findAll=function(){return fr(this,void 0,void 0,function(){return dr(this,function(t){return[2,this.formRepository.findAll()]})})},a.prototype.save=function(t){return fr(this,void 0,void 0,function(){return dr(this,function(i){return[2,this.formRepository.save(t)]})})},a}(Ii.FormRepository),Pi=new Ni(new Ui.MysqlFormRepository);I.default=Pi});var mr=d(U=>{"use strict";var _r=U&&U.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},vr=U&&U.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},br=U&&U.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(U,"__esModule",{value:!0});var yr=br(hr()),wr=br(J()),Fi=function(){function u(){var a=this;this.findAll=(0,wr.default)(function(t,i){return _r(a,void 0,void 0,function(){var n;return vr(this,function(e){switch(e.label){case 0:return[4,yr.default.findAll()];case 1:return n=e.sent(),i.status(200).json({forms:n}),[2]}})})}),this.save=(0,wr.default)(function(t,i){return _r(a,void 0,void 0,function(){var n;return vr(this,function(e){switch(e.label){case 0:return[4,yr.default.save(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"form created successfully",form:n}),[2]}})})})}return u}(),Bi=new Fi;U.default=Bi});var Er=d(de=>{"use strict";var yt=de&&de.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(de,"__esModule",{value:!0});var Li=require("express"),gr=yt(Oe()),pr=yt(mr()),Hi=require("express-validator"),Gi=yt($e()),Wi=ee(),wt=(0,Li.Router)();wt.route("/").get(gr.default,pr.default.findAll);wt.route("/").post(gr.default,(0,Gi.default)([Wi.Roles.admin]),[(0,Hi.body)("label").isString().withMessage("label is required")],pr.default.save);de.default=wt});var bt=d(k=>{"use strict";var Vi=k&&k.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Sr=k&&k.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Or=k&&k.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ji=k&&k.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(k,"__esModule",{value:!0});var Xi=Ji(ae()),xi=function(u){Vi(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAllUserResults=function(t){return Sr(this,void 0,void 0,function(){return Or(this,function(i){throw new Error("the method is not implemented")})})},a.prototype.findByUserIdAndFieldId=function(t){return Sr(this,void 0,void 0,function(){return Or(this,function(i){throw new Error("the method is not implemented")})})},a}(Xi.default);k.default=xi});var Rr=d(R=>{"use strict";var Yi=R&&R.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),je=R&&R.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Ce=R&&R.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},kr=R&&R.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(R,"__esModule",{value:!0});var Ie=kr(G()),Ki=kr(bt()),Zi=function(u){Yi(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAllUserResults=function(t){return je(this,void 0,void 0,function(){var i;return Ce(this,function(n){switch(n.label){case 0:return[4,Ie.default.query("SELECT * FROM result WHERE user_id = ?",[t.user_id])];case 1:return i=n.sent()[0],[2,i]}})})},a.prototype.save=function(t){return je(this,void 0,void 0,function(){var i;return Ce(this,function(n){switch(n.label){case 0:return[4,Ie.default.query("INSERT INTO result (user_id, label_id) VALUES (?, ?)",[t.user_id,t.field_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,user_id:t.user_id,field_id:t.field_id}]}})})},a.prototype.findByUserIdAndFieldId=function(t){return je(this,void 0,void 0,function(){var i;return Ce(this,function(n){switch(n.label){case 0:return[4,Ie.default.query("SELECT * FROM result WHERE user_id = ? AND field_id = ?",[t.user_id,t.field_id])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.update=function(t){return je(this,void 0,void 0,function(){var i;return Ce(this,function(n){switch(n.label){case 0:return[4,Ie.default.query("UPDATE result SET response = ? WHERE user_id = ? AND field_id = ?",[t.response,t.user_id,t.field_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,user_id:t.user_id,field_id:t.field_id}]}})})},a}(Ki.default);R.default=Zi});var Ar=d(T=>{"use strict";var zi=T&&T.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),mt=T&&T.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},gt=T&&T.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Tr=T&&T.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(T,"__esModule",{value:!0});var Qi=Tr(Rr()),$i=Tr(bt()),eu=function(u){zi(a,u);function a(t){var i=u.call(this)||this;return i.resultRepository=t,i}return a.prototype.findAllUserResults=function(t){return mt(this,void 0,void 0,function(){return gt(this,function(i){return[2,this.resultRepository.findAllUserResults(t)]})})},a.prototype.save=function(t){return mt(this,void 0,void 0,function(){return gt(this,function(i){return[2,this.resultRepository.save(t)]})})},a.prototype.addResponse=function(t){return mt(this,void 0,void 0,function(){var i;return gt(this,function(n){switch(n.label){case 0:return[4,this.resultRepository.findByUserIdAndFieldId(t)];case 1:return i=n.sent(),i?[2,this.resultRepository.update(t)]:[2,this.resultRepository.save(t)]}})})},a}($i.default),tu=new eu(new Qi.default);T.default=tu});var Ir=d(N=>{"use strict";var qr=N&&N.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Dr=N&&N.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Cr=N&&N.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(N,"__esModule",{value:!0});var Mr=Cr(Ar()),jr=Cr(J()),ru=function(){function u(){var a=this;this.findAllResults=(0,jr.default)(function(t,i){return qr(a,void 0,void 0,function(){var n;return Dr(this,function(e){switch(e.label){case 0:return[4,Mr.default.findAllUserResults(t.body)];case 1:return n=e.sent(),i.status(200).json({results:n}),[2]}})})}),this.addResponse=(0,jr.default)(function(t,i){return qr(a,void 0,void 0,function(){var n;return Dr(this,function(e){switch(e.label){case 0:return[4,Mr.default.addResponse(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"response added!",result:n}),[2]}})})})}return u}(),nu=new ru;N.default=nu});var Nr=d(he=>{"use strict";var iu=he&&he.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(he,"__esModule",{value:!0});var uu=require("express"),Ur=iu(Ir()),pt=require("express-validator"),Et=(0,uu.Router)();Et.route("/").get(Ur.default.findAllResults);Et.route("/").post([(0,pt.body)("user_id").isNumeric().withMessage("user_id is required"),(0,pt.body)("field_id").isNumeric().withMessage("field_id is required"),(0,pt.body)("response").isObject().withMessage("response is required")],Ur.default.addResponse);he.default=Et});var Pr=d(_e=>{"use strict";var A=_e&&_e.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(_e,"__esModule",{value:!0});var St=A(require("express")),au=A(require("path")),ou=A(require("cookie-parser")),su=A(require("cors")),lu=A(Tt()),Ue=A(X()),cu=A(Ft()),fu=A(ar()),du=A(Er()),hu=A(Nr()),b=(0,St.default)();b.use(St.default.json());b.use((0,ou.default)());b.use((0,su.default)({origin:["http://localhost:4000","http://localhost:5173"],credentials:!0}));b.get("/health",function(u,a){a.status(200).json({message:"Success!"})});b.use("/",St.default.static(au.default.resolve(__dirname,"static","dist")));b.use("".concat(Ue.default.API_PREFIX,"/users"),cu.default);b.use("".concat(Ue.default.API_PREFIX,"/"),fu.default);b.use("".concat(Ue.default.API_PREFIX,"/forms"),du.default);b.use("".concat(Ue.default.API_PREFIX,"/results"),hu.default);b.use("*",function(u,a){a.status(404).json({message:"route not found"})});b.use(lu.default);_e.default=b});var Fr=d(P=>{"use strict";var _u=P&&P.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},vu=P&&P.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},yu=P&&P.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(P,"__esModule",{value:!0});var Ne=yu(G()),wu=function(){return _u(void 0,void 0,void 0,function(){return vu(this,function(u){switch(u.label){case 0:return[4,Ne.default.query('INSERT INTO form (label, id) VALUES ("Formulario Ola", 1)')];case 1:return u.sent(),[4,Ne.default.query('INSERT INTO form_group (label, form_id) VALUES ("Informaci\xF3n referencial", 1)')];case 2:return u.sent(),[4,Ne.default.query(`INSERT INTO field (label, component, form_group_id, metadata)
     VALUES ("Ciudad", "input", 1,  '{"type": "text"}')`)];case 3:return u.sent(),[4,Ne.default.query(`INSERT INTO field (label, component, form_group_id, metadata)
     VALUES ("Fecha", "input", 1,  '{"type": "date"}')`)];case 4:return u.sent(),[2]}})})};P.default=wu});var Wr=d(F=>{"use strict";var Br=F&&F.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Lr=F&&F.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Pe=F&&F.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(F,"__esModule",{value:!0});var Hr=require("fs/promises"),bu=Pe(G()),mu=Pe(V()),Gr=ee(),gu=Pe(at()),pu=Pe(Fr()),Eu=function(){return Br(void 0,void 0,void 0,function(){var u,a;return Lr(this,function(t){switch(t.label){case 0:return[4,(0,Hr.readdir)(__dirname)];case 1:return u=t.sent(),u.forEach(function(i){return Br(void 0,void 0,void 0,function(){var n;return Lr(this,function(e){switch(e.label){case 0:return i==="db.ts"||i==="db.js"?[2]:[4,(0,Hr.readFile)("".concat(__dirname,"/").concat(i),{encoding:"utf-8"})];case 1:return n=e.sent(),[4,bu.default.query(n).catch(function(o){console.log(o.message)})];case 2:return e.sent(),[2]}})})}),[4,(0,gu.default)("1234")];case 2:return a=t.sent(),[4,mu.default.saveAdmin({email:"admin@email.com",fullname:"admin",area:Gr.UserArea.admin,password:a,role:Gr.Roles.admin}).catch(function(){console.log("duplicated admin user")}).finally(function(){console.log("user admin created")})];case 3:return t.sent(),[4,(0,pu.default)().catch(function(){console.log("the first form is already created")})];case 4:return t.sent(),[2]}})})};F.default=Eu});var Ot=exports&&exports.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(exports,"__esModule",{value:!0});var Su=Ot(Pr()),Vr=Ot(X()),Ou=Ot(Wr());(0,Ou.default)().then(function(){console.log("connecting database...")});Su.default.listen(Vr.default.PORT,function(){console.log("the server has started in port ".concat(Vr.default.PORT))});
