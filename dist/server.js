"use strict";var d=(u,a)=>()=>(a||u((a={exports:{}}).exports,a),a.exports);var N=d(me=>{"use strict";var On=me&&me.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();Object.defineProperty(me,"__esModule",{value:!0});var kn=function(u){On(a,u);function a(t){var i=u.call(this)||this;return i.isOperational=!0,i.message=t.message,i.statusCode=t.statusCode,i.errorCode=t.errorCode,i}return a}(Error);me.default=kn});var $=d(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});var qn={DATABASE_HOST:process.env.DATABASE_HOST,DATABASE_PASSWORD:process.env.DATABASE_PASSWORD,DATABASE_NAME:process.env.DATABASE_NAME,DATABASE_USERNAME:process.env.DATABASE_USERNAME,MODE:process.env.MODE,SECRET:process.env.SECRET,EMAIL_RESEND_TOKEN:process.env.EMAIL_RESEND_TOKEN,EMAIL_RESEND:process.env.EMAIL_RESEND,PORT:process.env.PORT,API_PREFIX:process.env.API_PREFIX,IP:process.env.IP};st.default=qn});var xt=d(U=>{"use strict";var Rn=U&&U.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Tn=U&&U.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},$t=U&&U.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(U,"__esModule",{value:!0});var An=$t(N()),Dn=$t($()),Mn=function(u,a,t,i){return Rn(void 0,void 0,void 0,function(){return Tn(this,function(n){return Array.isArray(u)?(console.log(u),t.status(400).json({message:"the body is not correct",errors:u}),[2]):u instanceof An.default?(u.isOperational=void 0,t.status(u.statusCode).json({error:u}),[2]):u instanceof Error?(t.status(400).json({message:u.message,error:Dn.default.MODE==="prod"?void 0:u}),[2]):(t.status(400).json({message:"error"}),[2])})})};U.default=Mn});var F=d(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});var jn={USER_EMAIL_NOT_FOUND:{errorCode:"1001",statusCode:404,message:"email not found"},INCORRECT_PASSWORD:{errorCode:"1002",statusCode:400,message:"the provided password is incorrect"},USER_NOT_FOUND:{errorCode:"1003",statusCode:404,message:"user not found"},USER_DOES_NOT_HAVE_ACCESS:{errorCode:"1004",statusCode:401,message:"you can't still login, you need admin permission"},EMAIL_ALREADY_EXISTS:{errorCode:"1004",statusCode:400,message:"the provided email already exists"},USER_NOT_VERIFIED:{errorCode:"1005",statusCode:404,message:"the user is not verified, please send the form to verify"},JWT_NOT_PROVIDED:{errorCode:"2001",statusCode:400,message:"please, login"},UNAUTHORIZED:{errorCode:"2002",statusCode:401,message:"unauthorized access"},JWT_IS_EXPIRED:{errorCode:"2003",statusCode:400,message:"the provided jwt is expired, login again"},FORM_NOT_FOUND:{errorCode:"2004",statusCode:404,message:"the form was not found"},HASH_IS_NOT_VALID:{errorCode:"3001",statusCode:400,message:"the provided hash is not valid"},HASH_NOT_PROVIDED:{errorCode:"3002",statusCode:400,message:"you need a hash"}};lt.default=jn});var P=d(ge=>{"use strict";var er=ge&&ge.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ge,"__esModule",{value:!0});var Cn=er(require("mysql2/promise")),Ue=er($()),In=Cn.default.createPool({database:Ue.default.DATABASE_NAME,user:Ue.default.DATABASE_USERNAME,host:Ue.default.DATABASE_HOST,password:Ue.default.DATABASE_PASSWORD,waitForConnections:!0,connectionLimit:10,queueLimit:1});ge.default=In});var ne=d(x=>{"use strict";var Fe=x&&x.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Pe=x&&x.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(x,"__esModule",{value:!0});var Nn=function(){function u(){}return u.prototype.findAll=function(){return Fe(this,void 0,void 0,function(){return Pe(this,function(a){throw new Error("method not implemented")})})},u.prototype.findById=function(a){return Fe(this,void 0,void 0,function(){return Pe(this,function(t){throw new Error("method not implemented")})})},u.prototype.save=function(a){return Fe(this,void 0,void 0,function(){return Pe(this,function(t){throw new Error("method not implemented")})})},u.prototype.update=function(a){return Fe(this,void 0,void 0,function(){return Pe(this,function(t){throw new Error("method not implemented")})})},u}();x.default=Nn});var dt=d(y=>{"use strict";var Hn=y&&y.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ct=y&&y.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ft=y&&y.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Un=y&&y.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(y,"__esModule",{value:!0});y.UserRepository=void 0;var Fn=Un(ne()),Pn=function(u){Hn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findByEmail=function(t){return ct(this,void 0,void 0,function(){return ft(this,function(i){throw new Error("method not implemented")})})},a.prototype.saveAdmin=function(t){return ct(this,void 0,void 0,function(){return ft(this,function(i){throw new Error("method not implemented")})})},a.prototype.toggleAccessUser=function(t,i){return ct(this,void 0,void 0,function(){return ft(this,function(n){throw new Error("method not implemented")})})},a}(Fn.default);y.UserRepository=Pn});var tr=d(E=>{"use strict";var Bn=E&&E.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ie=E&&E.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ue=E&&E.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ln=E&&E.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(E,"__esModule",{value:!0});var ae=Ln(P()),Gn=dt(),Vn=function(u){Bn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return ie(this,void 0,void 0,function(){var t;return ue(this,function(i){switch(i.label){case 0:return[4,ae.default.query("SELECT * FROM users")];case 1:return t=i.sent()[0],[2,t]}})})},a.prototype.findById=function(t){return ie(this,void 0,void 0,function(){var i;return ue(this,function(n){switch(n.label){case 0:return[4,ae.default.query("SELECT * FROM users WHERE id = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.save=function(t){return ie(this,void 0,void 0,function(){var i;return ue(this,function(n){switch(n.label){case 0:return[4,ae.default.query("INSERT INTO users (email, fullname, password, area, has_access, role) VALUES (?, ?, ?, ?, ?, ?)",[t.email,t.fullname,t.password,t.area,0,t.role])];case 1:return i=n.sent()[0],[2,{id:i.insertId,fullname:t.fullname,email:t.email,password:t.password,area:t.area}]}})})},a.prototype.findByEmail=function(t){return ie(this,void 0,void 0,function(){var i;return ue(this,function(n){switch(n.label){case 0:return[4,ae.default.query("SELECT id, email, password, fullname, area, has_access, role FROM users WHERE email = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.saveAdmin=function(t){return ie(this,void 0,void 0,function(){var i;return ue(this,function(n){switch(n.label){case 0:return[4,ae.default.query("INSERT INTO users (email, fullname, password, area, has_access, role, verified) VALUES (?, ?, ?, ?, ?, ?, ?)",[t.email,t.fullname,t.password,t.area,1,t.role,1])];case 1:return i=n.sent()[0],[2,{id:i.insertId,fullname:t.fullname,email:t.email,password:t.password,area:t.area}]}})})},a.prototype.toggleAccessUser=function(t,i){return ie(this,void 0,void 0,function(){var n;return ue(this,function(e){switch(e.label){case 0:return[4,ae.default.query("UPDATE users SET has_access = ? WHERE id = ?",[Number(t),i])];case 1:return n=e.sent()[0],[2,{id:n.insertId}]}})})},a}(Gn.UserRepository);E.default=Vn});var z=d(p=>{"use strict";var Wn=p&&p.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),oe=p&&p.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},se=p&&p.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},vt=p&&p.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(p,"__esModule",{value:!0});var ht=vt(F()),Jn=vt(tr()),Xn=dt(),_t=vt(N()),Yn=function(u){Wn(a,u);function a(t){var i=u.call(this)||this;return i.userRepository=t,i}return a.prototype.findAll=function(){return oe(this,void 0,void 0,function(){var t;return se(this,function(i){switch(i.label){case 0:return[4,this.userRepository.findAll()];case 1:return t=i.sent(),[2,t.map(function(n){return n.password=void 0,n})]}})})},a.prototype.save=function(t){return oe(this,void 0,void 0,function(){return se(this,function(i){return[2,this.userRepository.save(t).catch(function(n){if(n.code==="ER_DUP_ENTRY")throw new _t.default(ht.default.EMAIL_ALREADY_EXISTS);return n})]})})},a.prototype.saveAdmin=function(t){return oe(this,void 0,void 0,function(){return se(this,function(i){return[2,this.userRepository.saveAdmin(t)]})})},a.prototype.findByEmail=function(t){return oe(this,void 0,void 0,function(){var i;return se(this,function(n){switch(n.label){case 0:return[4,this.userRepository.findByEmail(t)];case 1:if(i=n.sent(),!i)throw new _t.default(ht.default.USER_EMAIL_NOT_FOUND);return[2,i]}})})},a.prototype.findById=function(t){return oe(this,void 0,void 0,function(){var i;return se(this,function(n){switch(n.label){case 0:return[4,this.userRepository.findById(t)];case 1:if(i=n.sent(),!i)throw new _t.default(ht.default.USER_NOT_FOUND);return[2,i]}})})},a.prototype.toggleAccessUser=function(t,i){return oe(this,void 0,void 0,function(){return se(this,function(n){return[2,this.userRepository.toggleAccessUser(t,i)]})})},a}(Xn.UserRepository),Kn=new Yn(new Jn.default);p.default=Kn});var H=d(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});var Zn=require("express-validator"),zn=function(u){return function(a,t,i){var n=(0,Zn.validationResult)(a);if(!n.isEmpty())return i(n.array());u(a,t,i).catch(function(e){i(e)})}};yt.default=zn});var nr=d(B=>{"use strict";var Be=B&&B.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Le=B&&B.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},rr=B&&B.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(B,"__esModule",{value:!0});var Ge=rr(z()),Ve=rr(H()),Qn=function(){function u(){var a=this;this.findAll=(0,Ve.default)(function(t,i){return Be(a,void 0,void 0,function(){var n;return Le(this,function(e){switch(e.label){case 0:return[4,Ge.default.findAll()];case 1:return n=e.sent(),i.status(200).json({users:n.filter(function(s){return s.has_access})}),[2]}})})}),this.findAllNotifications=(0,Ve.default)(function(t,i){return Be(a,void 0,void 0,function(){var n;return Le(this,function(e){switch(e.label){case 0:return[4,Ge.default.findAll()];case 1:return n=e.sent(),i.status(200).json({users:n.filter(function(s){return!s.has_access})}),[2]}})})}),this.save=(0,Ve.default)(function(t,i){return Be(a,void 0,void 0,function(){var n;return Le(this,function(e){switch(e.label){case 0:return[4,Ge.default.save(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"user created successfully",user:n}),[2]}})})}),this.toggleAccessUser=(0,Ve.default)(function(t,i){return Be(a,void 0,void 0,function(){var n,e,s;return Le(this,function(l){switch(l.label){case 0:return n=t.body,e=n.userId,s=n.access,[4,Ge.default.toggleAccessUser(s,e)];case 1:return l.sent(),i.status(200).json({message:"updated user successfully"}),[2]}})})})}return u}(),$n=new Qn;B.default=$n});var bt=d(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});var xn={JWT_AUTH:"ola_auth_jwt"};wt.default=xn});var Et=d(_=>{"use strict";var mt=_&&_.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},gt=_&&_.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},ir=_&&_.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(_,"__esModule",{value:!0});_.verifyTokenUser=_.verifyToken=_.createToken=void 0;var ur=ir(require("jsonwebtoken")),We=ir($());function ei(u){return mt(this,void 0,void 0,function(){return gt(this,function(a){if(!We.default.SECRET)throw new Error("secret not provided");return[2,ur.default.sign(u,We.default.SECRET,{expiresIn:"1d"})]})})}_.createToken=ei;function ar(u){return mt(this,void 0,void 0,function(){return gt(this,function(a){if(!We.default.SECRET)throw new Error("secret not provided");return[2,ur.default.verify(u,We.default.SECRET)]})})}_.verifyToken=ar;function ti(u){return mt(this,void 0,void 0,function(){var a;return gt(this,function(t){switch(t.label){case 0:return[4,ar(u)];case 1:return a=t.sent(),[2,a]}})})}_.verifyTokenUser=ti});var pe=d(L=>{"use strict";var ri=L&&L.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ni=L&&L.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ee=L&&L.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(L,"__esModule",{value:!0});var ii=Ee(F()),ui=Ee(bt()),ai=Ee(z()),oi=Ee(H()),si=Ee(N()),li=Et(),ci=(0,oi.default)(function(u,a,t){return ri(void 0,void 0,void 0,function(){var i,n,e;return ni(this,function(s){switch(s.label){case 0:if(i=(e=u.cookies)===null||e===void 0?void 0:e[ui.default.JWT_AUTH],!i)throw new si.default(ii.default.JWT_NOT_PROVIDED);return[4,(0,li.verifyTokenUser)(i)];case 1:return n=s.sent(),[4,ai.default.findById(n.id)];case 2:return s.sent(),u.cookieJwt=i,u.decodedToken=n,t(),[2]}})})});L.default=ci});var pt=d(G=>{"use strict";var fi=G&&G.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},di=G&&G.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Je=G&&G.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(G,"__esModule",{value:!0});var hi=Je(F()),_i=Je(z()),vi=Je(H()),yi=Je(N());function wi(u){var a=this;return(0,vi.default)(function(t,i,n){return fi(a,void 0,void 0,function(){var e,s;return di(this,function(l){switch(l.label){case 0:return e=t.decodedToken,[4,_i.default.findById(e?.id)];case 1:if(s=l.sent(),!u.includes(s?.role))throw new yi.default(hi.default.UNAUTHORIZED);return n(),[2]}})})})}G.default=wi});var ce=d(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.Roles=le.UserArea=void 0;var or;(function(u){u.admin="admin",u.commercial="Asesor comercial",u.design="Dise\xF1o",u.communityManager="Community manager",u.photograph="Fot\xF3grafo",u.telemarketing="Telemarketing",u.secretary="secretar\xEDa"})(or||(le.UserArea=or={}));var sr;(function(u){u.admin="admin",u.user="user",u.sales="sales"})(sr||(le.Roles=sr={}))});var cr=d(Se=>{"use strict";var St=Se&&Se.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Se,"__esModule",{value:!0});var bi=require("express"),Ot=St(nr()),kt=St(pe()),qt=St(pt()),Rt=ce(),lr=require("express-validator"),Xe=(0,bi.Router)();Xe.route("/").get(kt.default,(0,qt.default)([Rt.Roles.admin]),Ot.default.findAll);Xe.route("/notifications").get(kt.default,(0,qt.default)([Rt.Roles.admin]),Ot.default.findAllNotifications);Xe.route("/toggle-access").post([(0,lr.body)("userId").isNumeric(),(0,lr.body)("access").isBoolean()],kt.default,(0,qt.default)([Rt.Roles.admin]),Ot.default.toggleAccessUser);Se.default=Xe});var At=d(S=>{"use strict";var fr=S&&S.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},dr=S&&S.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(S,"__esModule",{value:!0});S.crypPassword=S.comparePassword=void 0;var Tt=require("bcrypt");function mi(u,a){return fr(this,void 0,void 0,function(){return dr(this,function(t){return[2,(0,Tt.compare)(u,a)]})})}S.comparePassword=mi;function hr(u){return fr(this,void 0,void 0,function(){var a;return dr(this,function(t){switch(t.label){case 0:return[4,(0,Tt.genSalt)()];case 1:return a=t.sent(),[2,(0,Tt.hash)(u,a)]}})})}S.crypPassword=hr;S.default=hr});var Dt=d(O=>{"use strict";var gi=O&&O.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ei=O&&O.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},pi=O&&O.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Si=O&&O.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(O,"__esModule",{value:!0});var Oi=Si(ne()),ki=function(u){gi(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.find=function(t){return Ei(this,void 0,void 0,function(){return pi(this,function(i){throw new Error("method not implemented")})})},a}(Oi.default);O.default=ki});var br=d(k=>{"use strict";var qi=k&&k.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),_r=k&&k.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},vr=k&&k.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},wr=k&&k.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(k,"__esModule",{value:!0});var yr=wr(P()),Ri=wr(Dt()),Ti=function(u){qi(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.save=function(t){return _r(this,void 0,void 0,function(){var i;return vr(this,function(n){switch(n.label){case 0:return[4,yr.default.query("INSERT INTO blacklist (token, user_id) VALUES (?, ?)",[t.token,t.user_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,token:t.token}]}})})},a.prototype.find=function(t){return _r(this,void 0,void 0,function(){var i;return vr(this,function(n){switch(n.label){case 0:return[4,yr.default.query("SELECT * FROM blacklist WHERE user_id = ? AND token = ?",[t.user_id,t.token])];case 1:return i=n.sent()[0][0],[2,i]}})})},a}(Ri.default);k.default=Ti});var pr=d(q=>{"use strict";var Ai=q&&q.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),mr=q&&q.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},gr=q&&q.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Er=q&&q.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(q,"__esModule",{value:!0});var Di=Er(Dt()),Mi=Er(br()),ji=function(u){Ai(a,u);function a(t){var i=u.call(this)||this;return i.blacklistRespository=t,i}return a.prototype.find=function(t){return mr(this,void 0,void 0,function(){var i;return gr(this,function(n){return i=this.blacklistRespository.find(t),[2,i]})})},a.prototype.save=function(t){return mr(this,void 0,void 0,function(){return gr(this,function(i){return[2,this.blacklistRespository.save(t)]})})},a}(Di.default),Ci=new ji(new Mi.default);q.default=Ci});var qr=d(h=>{"use strict";var Ii=h&&h.__createBinding||(Object.create?function(u,a,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(a,t);(!n||("get"in n?!a.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return a[t]}}),Object.defineProperty(u,i,n)}:function(u,a,t,i){i===void 0&&(i=t),u[i]=a[t]}),Ni=h&&h.__setModuleDefault||(Object.create?function(u,a){Object.defineProperty(u,"default",{enumerable:!0,value:a})}:function(u,a){u.default=a}),Hi=h&&h.__importStar||function(u){if(u&&u.__esModule)return u;var a={};if(u!=null)for(var t in u)t!=="default"&&Object.prototype.hasOwnProperty.call(u,t)&&Ii(a,u,t);return Ni(a,u),a},Mt=h&&h.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},jt=h&&h.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ye=h&&h.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(h,"__esModule",{value:!0});var Ct=Ye(F()),Ui=ce(),Sr=Hi(At()),It=Ye(N()),Or=Ye(pr()),kr=Ye(z()),Fi=function(){function u(){}return u.prototype.signup=function(a){return Mt(this,void 0,void 0,function(){var t,i;return jt(this,function(n){switch(n.label){case 0:return t=a,[4,(0,Sr.default)(a.password||"")];case 1:return t.password=n.sent(),a.role=Ui.Roles.user,[4,kr.default.save(a)];case 2:return i=n.sent(),[2,i]}})})},u.prototype.login=function(a){return Mt(this,void 0,void 0,function(){var t,i;return jt(this,function(n){switch(n.label){case 0:return[4,kr.default.findByEmail(a.email)];case 1:if(t=n.sent(),!t.has_access)throw new It.default(Ct.default.USER_DOES_NOT_HAVE_ACCESS);return[4,(0,Sr.comparePassword)(a.password,t.password)];case 2:if(i=n.sent(),!i)throw new It.default(Ct.default.INCORRECT_PASSWORD);return t.password=void 0,[2,t]}})})},u.prototype.logout=function(a){return Mt(this,void 0,void 0,function(){var t;return jt(this,function(i){switch(i.label){case 0:return[4,Or.default.find({user_id:a.user_id,token:a.token})];case 1:if(t=i.sent(),t)throw new It.default(Ct.default.JWT_IS_EXPIRED);return[4,Or.default.save({user_id:a.user_id,token:a.token})];case 2:return i.sent(),[2]}})})},u}(),Pi=new Fi;h.default=Pi});var Tr=d(w=>{"use strict";var Bi=w&&w.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Li=w&&w.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Gi=w&&w.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(w,"__esModule",{value:!0});w.removeTokenCookie=w.createTokenCookie=void 0;var Rr=Gi(bt()),Vi=Et(),Nt=new Date;Nt.setDate(Nt.getDate()+1);var Wi=new Date(0);function Ji(u,a){return Bi(this,void 0,void 0,function(){var t;return Li(this,function(i){switch(i.label){case 0:return[4,(0,Vi.createToken)(a)];case 1:return t=i.sent(),u.cookie(Rr.default.JWT_AUTH,t,{httpOnly:!0,path:"/",expires:Nt}),[2]}})})}w.createTokenCookie=Ji;function Xi(u){u.cookie(Rr.default.JWT_AUTH,"",{httpOnly:!0,path:"/",expires:Wi})}w.removeTokenCookie=Xi});var Ar=d(V=>{"use strict";var Ke=V&&V.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Ze=V&&V.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Oe=V&&V.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(V,"__esModule",{value:!0});var Yi=Oe(F()),Ht=Oe(qr()),Ki=Oe(z()),ze=Oe(H()),Ut=Tr(),Zi=Oe(N()),zi=function(){function u(){var a=this;this.signup=(0,ze.default)(function(t,i){return Ke(a,void 0,void 0,function(){var n;return Ze(this,function(e){switch(e.label){case 0:return[4,Ht.default.signup(t.body)];case 1:return n=e.sent(),n.password=void 0,[4,(0,Ut.createTokenCookie)(i,{id:n.id})];case 2:return e.sent(),i.status(200).json({message:"user created successfully",user:n}),[2]}})})}),this.login=(0,ze.default)(function(t,i){return Ke(a,void 0,void 0,function(){var n;return Ze(this,function(e){switch(e.label){case 0:return[4,Ht.default.login(t.body)];case 1:return n=e.sent(),[4,(0,Ut.createTokenCookie)(i,{id:n.id})];case 2:return e.sent(),i.status(200).json({messsage:"user authenticated!",user:n}),[2]}})})}),this.logout=(0,ze.default)(function(t,i){return Ke(a,void 0,void 0,function(){var n,e;return Ze(this,function(s){switch(s.label){case 0:return n=t.cookieJwt,e=t.decodedToken,[4,Ht.default.logout({user_id:e.id,token:n})];case 1:return s.sent(),(0,Ut.removeTokenCookie)(i),i.json({message:"you are logout!"}),[2]}})})}),this.athenticate=(0,ze.default)(function(t,i){return Ke(a,void 0,void 0,function(){var n,e;return Ze(this,function(s){switch(s.label){case 0:return n=t.decodedToken,[4,Ki.default.findById(n.id)];case 1:if(e=s.sent(),!e.has_access)throw new Zi.default(Yi.default.USER_DOES_NOT_HAVE_ACCESS);return e.password=void 0,i.status(200).json({message:"user authenticated",user:e}),[2]}})})})}return u}(),Qi=new zi;V.default=Qi});var jr=d(ke=>{"use strict";var Dr=ke&&ke.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ke,"__esModule",{value:!0});var $i=require("express"),Qe=Dr(Ar()),fe=require("express-validator"),xi=ce(),Mr=Dr(pe()),qe=(0,$i.Router)();qe.route("/signup").post([(0,fe.body)("fullname").isString(),(0,fe.body)("email").isEmail(),(0,fe.body)("password").isString(),(0,fe.body)("area").isIn(Object.values(xi.UserArea))],Qe.default.signup);qe.route("/login").post([(0,fe.body)("email").isEmail(),(0,fe.body)("password").isString()],Qe.default.login);qe.route("/me").get(Mr.default,Qe.default.athenticate);qe.route("/logout").get(Mr.default,Qe.default.logout);ke.default=qe});var Ft=d(R=>{"use strict";var eu=R&&R.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Cr=R&&R.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Ir=R&&R.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},tu=R&&R.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(R,"__esModule",{value:!0});var ru=tu(ne()),nu=function(u){eu(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAllUserResults=function(t){return Cr(this,void 0,void 0,function(){return Ir(this,function(i){throw new Error("the method is not implemented")})})},a.prototype.findByFormIdAndFieldId=function(t){return Cr(this,void 0,void 0,function(){return Ir(this,function(i){throw new Error("the method is not implemented")})})},a}(ru.default);R.default=nu});var Hr=d(T=>{"use strict";var iu=T&&T.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),$e=T&&T.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},xe=T&&T.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Nr=T&&T.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(T,"__esModule",{value:!0});var et=Nr(P()),uu=Nr(Ft()),au=function(u){iu(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAllUserResults=function(t){return $e(this,void 0,void 0,function(){var i;return xe(this,function(n){switch(n.label){case 0:return[4,et.default.query("SELECT * FROM result ",[t.form_id])];case 1:return i=n.sent()[0],[2,i]}})})},a.prototype.save=function(t){return $e(this,void 0,void 0,function(){var i;return xe(this,function(n){switch(n.label){case 0:return[4,et.default.query("INSERT INTO result (form_id, field_id, response) VALUES (?, ?, ?)",[t.form_id,t.field_id,JSON.stringify(t.response)])];case 1:return i=n.sent()[0],[2,{id:i.insertId,form_id:t.form_id,field_id:t.field_id}]}})})},a.prototype.findByFormIdAndFieldId=function(t){return $e(this,void 0,void 0,function(){var i;return xe(this,function(n){switch(n.label){case 0:return[4,et.default.query("SELECT * FROM result WHERE form_id = ? AND field_id = ?",[t.form_id,t.field_id])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.update=function(t){return $e(this,void 0,void 0,function(){var i;return xe(this,function(n){switch(n.label){case 0:return[4,et.default.query("UPDATE result SET response = ? WHERE form_id = ? AND field_id = ?",[JSON.stringify(t.response),t.form_id,t.field_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,form_id:t.form_id,field_id:t.field_id}]}})})},a}(uu.default);T.default=au});var Fr=d(A=>{"use strict";var ou=A&&A.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Pt=A&&A.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Bt=A&&A.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ur=A&&A.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(A,"__esModule",{value:!0});var su=Ur(Hr()),lu=Ur(Ft()),cu=function(u){ou(a,u);function a(t){var i=u.call(this)||this;return i.resultRepository=t,i}return a.prototype.findAllUserResults=function(t){return Pt(this,void 0,void 0,function(){return Bt(this,function(i){return[2,this.resultRepository.findAllUserResults(t)]})})},a.prototype.save=function(t){return Pt(this,void 0,void 0,function(){return Bt(this,function(i){return[2,this.resultRepository.save(t)]})})},a.prototype.addResponse=function(t){return Pt(this,void 0,void 0,function(){var i;return Bt(this,function(n){switch(n.label){case 0:return[4,this.resultRepository.findByFormIdAndFieldId(t)];case 1:return i=n.sent(),i?[2,this.resultRepository.update(t)]:[2,this.resultRepository.save(t)]}})})},a}(lu.default),fu=new cu(new su.default);A.default=fu});var Wr=d(W=>{"use strict";var Pr=W&&W.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Br=W&&W.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Vr=W&&W.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(W,"__esModule",{value:!0});var Lr=Vr(Fr()),Gr=Vr(H()),du=function(){function u(){var a=this;this.findAllResults=(0,Gr.default)(function(t,i){return Pr(a,void 0,void 0,function(){var n;return Br(this,function(e){switch(e.label){case 0:return[4,Lr.default.findAllUserResults(t.body)];case 1:return n=e.sent(),i.status(200).json({results:n}),[2]}})})}),this.addResponse=(0,Gr.default)(function(t,i){return Pr(a,void 0,void 0,function(){var n;return Br(this,function(e){switch(e.label){case 0:return[4,Lr.default.addResponse(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"response added!",result:n}),[2]}})})})}return u}(),hu=new du;W.default=hu});var Jr=d(J=>{"use strict";var _u=J&&J.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},vu=J&&J.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},tt=J&&J.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(J,"__esModule",{value:!0});var yu=tt(F()),wu=tt(z()),bu=tt(H()),mu=tt(N()),gu=(0,bu.default)(function(u,a,t){return _u(void 0,void 0,void 0,function(){var i,n;return vu(this,function(e){switch(e.label){case 0:return i=u.decodedToken,[4,wu.default.findById(i?.id)];case 1:if(n=e.sent(),!n.verified)throw new mu.default(yu.default.USER_NOT_VERIFIED);return t(),[2]}})})});J.default=gu});var Yr=d(Re=>{"use strict";var Gt=Re&&Re.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Re,"__esModule",{value:!0});var Eu=require("express"),Xr=Gt(Wr()),Lt=require("express-validator"),pu=Gt(Jr()),Su=Gt(pe()),Vt=(0,Eu.Router)();Vt.route("/").get(Su.default,pu.default,Xr.default.findAllResults);Vt.route("/").post([(0,Lt.body)("form_id").isNumeric().withMessage("form_id is required"),(0,Lt.body)("field_id").isNumeric().withMessage("field_id is required"),(0,Lt.body)("response").isObject().withMessage("response is required")],Xr.default.addResponse);Re.default=Vt});var Wt=d(ee=>{"use strict";var Ou=ee&&ee.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ku=ee&&ee.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ee,"__esModule",{value:!0});var qu=ku(ne()),Ru=function(u){Ou(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a}(qu.default);ee.default=Ru});var Zr=d(D=>{"use strict";var Tu=D&&D.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Au=D&&D.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Du=D&&D.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Kr=D&&D.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(D,"__esModule",{value:!0});var Mu=Kr(P()),ju=Kr(Wt()),Cu=function(u){Tu(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return Au(this,void 0,void 0,function(){var t,i,n,e,s,l,c,r,o;return Du(this,function(f){switch(f.label){case 0:return[4,Mu.default.query({sql:`
      SELECT form_scheme.*, form_group.*, field.* from form_scheme 
        LEFT JOIN form_group 
        ON form_group.form_scheme_id = form_scheme.id
        LEFT JOIN field
        ON field.form_group_id = form_group.id`,nestTables:!0})];case 1:for(t=f.sent()[0],i=new Map,n=new Map,e=new Map,t.forEach(function(g){var te=g.form_scheme,re=g.form_group,be=g.field;i.set(te.id,te),n.set(re.id,re),e.set(be.id,be)}),s=Array.from(i.values()),l=function(g){g.form_groups||(g.form_groups=[]),Array.from(n.values()).forEach(function(te){if(te.form_scheme_id===g.id){var re=g.form_groups.push(te);Array.from(e.values()).forEach(function(be){be.form_group_id===te.id&&(g.form_groups[re-1].fields||(g.form_groups[re-1].fields=[]),g.form_groups[re-1].fields.push(be))})}})},c=0,r=s;c<r.length;c++)o=r[c],l(o);return[2,Array.from(i.values())]}})})},a}(ju.default);D.default=Cu});var Qr=d(M=>{"use strict";var Iu=M&&M.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Nu=M&&M.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Hu=M&&M.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},zr=M&&M.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(M,"__esModule",{value:!0});var Uu=zr(Wt()),Fu=zr(Zr()),Pu=function(u){Iu(a,u);function a(t){var i=u.call(this)||this;return i.formSchemeRespository=t,i}return a.prototype.findAll=function(){return Nu(this,void 0,void 0,function(){return Hu(this,function(t){return[2,this.formSchemeRespository.findAll()]})})},a}(Uu.default),Bu=new Pu(new Fu.default);M.default=Bu});var xr=d(X=>{"use strict";var Lu=X&&X.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Gu=X&&X.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},$r=X&&X.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(X,"__esModule",{value:!0});var Vu=$r(Qr()),Wu=$r(H()),Ju=function(){function u(){var a=this;this.findAll=(0,Wu.default)(function(t,i){return Lu(a,void 0,void 0,function(){var n;return Gu(this,function(e){switch(e.label){case 0:return[4,Vu.default.findAll()];case 1:return n=e.sent(),i.status(200).json({form_schemes:n}),[2]}})})})}return u}(),Xu=new Ju;X.default=Xu});var tn=d(Te=>{"use strict";var Yu=Te&&Te.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Te,"__esModule",{value:!0});var Ku=require("express"),Zu=Yu(xr()),en=(0,Ku.Router)();en.route("/").get(Zu.default.findAll);Te.default=en});var Yt=d(b=>{"use strict";var zu=b&&b.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Jt=b&&b.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Xt=b&&b.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Qu=b&&b.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(b,"__esModule",{value:!0});b.FormRepository=void 0;var $u=Qu(ne()),xu=function(u){zu(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.addHash=function(t){return Jt(this,void 0,void 0,function(){return Xt(this,function(i){throw new Error("the method is not implemented")})})},a.prototype.findByHash=function(t){return Jt(this,void 0,void 0,function(){return Xt(this,function(i){throw new Error("the method is not implemented")})})},a.prototype.removeHash=function(t){return Jt(this,void 0,void 0,function(){return Xt(this,function(i){throw new Error("the method is not implemented")})})},a}($u.default);b.FormRepository=xu});var rn=d(m=>{"use strict";var ea=m&&m.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),de=m&&m.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},he=m&&m.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},ta=m&&m.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(m,"__esModule",{value:!0});m.MysqlFormRepository=void 0;var _e=ta(P()),ra=Yt(),na=function(u){ea(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return de(this,void 0,void 0,function(){var t;return he(this,function(i){switch(i.label){case 0:return[4,_e.default.query({sql:"SELECT * from form"})];case 1:return t=i.sent()[0],[2,t]}})})},a.prototype.save=function(t){return de(this,void 0,void 0,function(){var i;return he(this,function(n){switch(n.label){case 0:return[4,_e.default.query("INSERT INTO form (done, hash, form_scheme_id, user_id) VALUES (?, ?, ?, ?)",[!1,null,t.form_scheme_id,t.user_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,done:!1,hash:null,form_scheme_id:t.form_scheme_id,user_id:t.user_id}]}})})},a.prototype.addHash=function(t){return de(this,void 0,void 0,function(){var i;return he(this,function(n){switch(n.label){case 0:return[4,_e.default.query("UPDATE form SET hash = ? WHERE id = ?",[t.hash,t.id])];case 1:return i=n.sent()[0],[2,{id:t.id,hash:t.hash}]}})})},a.prototype.findById=function(t){return de(this,void 0,void 0,function(){var i;return he(this,function(n){switch(n.label){case 0:return[4,_e.default.query("SELECT * FROM form WHERE id = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.findByHash=function(t){return de(this,void 0,void 0,function(){var i;return he(this,function(n){switch(n.label){case 0:return[4,_e.default.query("SELECT * FROM form WHERE hash = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.removeHash=function(t){return de(this,void 0,void 0,function(){var i;return he(this,function(n){switch(n.label){case 0:return[4,_e.default.query("UPDATE form SET hash = null WHERE id = ?",[t])];case 1:return i=n.sent()[0],[2,{id:t,hash:null}]}})})},a}(ra.FormRepository);m.MysqlFormRepository=na});var Kt=d(Q=>{"use strict";var nn=Q&&Q.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Q,"__esModule",{value:!0});Q.verifyHmacHash=Q.generateHmacHash=void 0;var un=nn(require("crypto")),an=nn($());function ia(u){var a=un.default.createHmac("sha1",an.default.SECRET);return a.write(JSON.stringify(u)),a.end(),a.read().toString("hex")}Q.generateHmacHash=ia;function ua(u,a){var t=un.default.createHmac("sha1",an.default.SECRET);t.write(JSON.stringify(u)),t.end();var i=t.read().toString("hex");return i===a}Q.verifyHmacHash=ua});var Zt=d(j=>{"use strict";var aa=j&&j.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ve=j&&j.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ye=j&&j.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},ln=j&&j.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(j,"__esModule",{value:!0});var oa=Yt(),sa=rn(),on=ln(N()),sn=ln(F()),la=Kt(),ca=function(u){aa(a,u);function a(t){var i=u.call(this)||this;return i.formRepository=t,i}return a.prototype.findAll=function(){return ve(this,void 0,void 0,function(){return ye(this,function(t){return[2,this.formRepository.findAll()]})})},a.prototype.save=function(t){return ve(this,void 0,void 0,function(){return ye(this,function(i){return[2,this.formRepository.save(t)]})})},a.prototype.findById=function(t){return ve(this,void 0,void 0,function(){var i;return ye(this,function(n){switch(n.label){case 0:return[4,this.formRepository.findById(t)];case 1:if(i=n.sent(),!i)throw new on.default(sn.default.FORM_NOT_FOUND);return[2,i]}})})},a.prototype.addHash=function(t){return ve(this,void 0,void 0,function(){var i;return ye(this,function(n){switch(n.label){case 0:return[4,this.findById(t.id)];case 1:return n.sent(),i=(0,la.generateHmacHash)({form_id:t.id}),t.hash=i,[2,this.formRepository.addHash(t)]}})})},a.prototype.findByHash=function(t){return ve(this,void 0,void 0,function(){var i;return ye(this,function(n){switch(n.label){case 0:return[4,this.formRepository.findByHash(t)];case 1:if(i=n.sent(),!i)throw new on.default(sn.default.FORM_NOT_FOUND);return[2,i]}})})},a.prototype.removeHash=function(t){return ve(this,void 0,void 0,function(){return ye(this,function(i){return[2,this.formRepository.removeHash(t)]})})},a}(oa.FormRepository),fa=new ca(new sa.MysqlFormRepository);j.default=fa});var fn=d(C=>{"use strict";var rt=C&&C.__assign||function(){return rt=Object.assign||function(u){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(u[n]=a[n])}return u},rt.apply(this,arguments)},Ae=C&&C.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},De=C&&C.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},cn=C&&C.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(C,"__esModule",{value:!0});var Me=cn(Zt()),je=cn(H()),da=function(){function u(){var a=this;this.findAll=(0,je.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n;return De(this,function(e){switch(e.label){case 0:return[4,Me.default.findAll()];case 1:return n=e.sent(),i.status(200).json({forms:n}),[2]}})})}),this.save=(0,je.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n,e;return De(this,function(s){switch(s.label){case 0:return[4,Me.default.save(rt(rt({},t.body),{user_id:(e=t.decodedToken)===null||e===void 0?void 0:e.id}))];case 1:return n=s.sent(),i.status(200).json({message:"form created successfully",form:n}),[2]}})})}),this.generateLink=(0,je.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n;return De(this,function(e){switch(e.label){case 0:return[4,Me.default.addHash(t.body)];case 1:return n=e.sent(),i.status(200).json({form:n}),[2]}})})}),this.generateForm=(0,je.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n;return De(this,function(e){switch(e.label){case 0:return[4,Me.default.findById(t.formId)];case 1:return n=e.sent(),i.status(200).json({form:n}),[2]}})})}),this.invalidateLink=(0,je.default)(function(t,i){return Ae(a,void 0,void 0,function(){var n;return De(this,function(e){switch(e.label){case 0:return n=t.body.id,[4,Me.default.removeHash(n)];case 1:return e.sent(),i.status(200).json({message:"the link is invalid now"}),[2]}})})})}return u}(),ha=new da;C.default=ha});var dn=d(Y=>{"use strict";var _a=Y&&Y.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},va=Y&&Y.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},nt=Y&&Y.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Y,"__esModule",{value:!0});var ya=nt(F()),wa=nt(Zt()),ba=nt(H()),ma=Kt(),ga=nt(N()),Ea=(0,ba.default)(function(u,a,t){return _a(void 0,void 0,void 0,function(){var i,n,e;return va(this,function(s){switch(s.label){case 0:return i=u.params.hash,[4,wa.default.findByHash(i)];case 1:if(n=s.sent(),e=(0,ma.verifyHmacHash)({form_id:n?.id},i),!e)throw new ga.default(ya.default.HASH_IS_NOT_VALID);return u.formId=n?.id,t(),[2]}})})});Y.default=Ea});var vn=d(Ce=>{"use strict";var it=Ce&&Ce.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Ce,"__esModule",{value:!0});var pa=require("express"),_n=it(pe()),Ie=it(fn()),zt=require("express-validator"),Sa=it(pt()),hn=ce(),Oa=it(dn()),we=(0,pa.Router)();we.route("/").get(_n.default,Ie.default.findAll);we.route("/").post(_n.default,(0,Sa.default)([hn.Roles.admin,hn.Roles.sales]),[(0,zt.body)("form_scheme_id").isNumeric().withMessage("form_scheme_id is required")],Ie.default.save);we.route("/generate-link").post([(0,zt.body)("id").isNumeric().withMessage("id is required")],Ie.default.generateLink);we.route("/generate-form/:hash").get(Oa.default,Ie.default.generateForm);we.route("/invalidate-link").post([(0,zt.body)("id").isNumeric().withMessage("id is required")],Ie.default.invalidateLink);Ce.default=we});var yn=d(Ne=>{"use strict";var I=Ne&&Ne.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Ne,"__esModule",{value:!0});var Qt=I(require("express")),ka=I(require("path")),qa=I(require("cookie-parser")),Ra=I(require("cors")),Ta=I(xt()),He=I($()),Aa=I(cr()),Da=I(jr()),Ma=I(Yr()),ja=I(tn()),Ca=I(vn()),v=(0,Qt.default)();v.use(Qt.default.json());v.use((0,qa.default)());v.use((0,Ra.default)({origin:["http://localhost:4000","http://localhost:5173"],credentials:!0}));v.get("/health",function(u,a){a.status(200).json({message:"Success!"})});v.use("/",Qt.default.static(ka.default.resolve(__dirname,"static","dist")));v.use("".concat(He.default.API_PREFIX,"/users"),Aa.default);v.use("".concat(He.default.API_PREFIX,"/"),Da.default);v.use("".concat(He.default.API_PREFIX,"/form-schemes"),ja.default);v.use("".concat(He.default.API_PREFIX,"/forms"),Ca.default);v.use("".concat(He.default.API_PREFIX,"/results"),Ma.default);v.use("*",function(u,a){a.status(404).json({message:"route not found"})});v.use(Ta.default);Ne.default=v});var wn=d(K=>{"use strict";var Ia=K&&K.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Na=K&&K.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ha=K&&K.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(K,"__esModule",{value:!0});var ut=Ha(P()),Ua=function(){return Ia(void 0,void 0,void 0,function(){return Na(this,function(u){switch(u.label){case 0:return[4,ut.default.query('INSERT INTO form_scheme (label, id) VALUES ("Formulario Ola", 1)')];case 1:return u.sent(),[4,ut.default.query('INSERT INTO form_group (label, form_scheme_id) VALUES ("Informaci\xF3n referencial", 1)')];case 2:return u.sent(),[4,ut.default.query(`INSERT INTO field (label, component, form_group_id, metadata)
     VALUES ("Ciudad", "input", 1,  '{"type": "text"}')`)];case 3:return u.sent(),[4,ut.default.query(`INSERT INTO field (label, component, form_group_id, metadata)
     VALUES ("Fecha", "input", 1,  '{"type": "date"}')`)];case 4:return u.sent(),[2]}})})};K.default=Ua});var pn=d(Z=>{"use strict";var bn=Z&&Z.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(s){s(e)})}return new(t||(t=Promise))(function(e,s){function l(o){try{r(i.next(o))}catch(f){s(f)}}function c(o){try{r(i.throw(o))}catch(f){s(f)}}function r(o){o.done?e(o.value):n(o.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},mn=Z&&Z.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(r){return function(o){return c([r,o])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(o){r=[6,o],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},at=Z&&Z.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Z,"__esModule",{value:!0});var gn=require("fs/promises"),Fa=at(P()),Pa=at(z()),En=ce(),Ba=at(At()),La=at(wn()),Ga=function(){return bn(void 0,void 0,void 0,function(){var u,a;return mn(this,function(t){switch(t.label){case 0:return[4,(0,gn.readdir)(__dirname)];case 1:return u=t.sent(),u.forEach(function(i){return bn(void 0,void 0,void 0,function(){var n;return mn(this,function(e){switch(e.label){case 0:return i==="db.ts"||i==="db.js"?[2]:[4,(0,gn.readFile)("".concat(__dirname,"/").concat(i),{encoding:"utf-8"})];case 1:return n=e.sent(),[4,Fa.default.query(n).catch(function(s){console.log(s.message)})];case 2:return e.sent(),[2]}})})}),[4,(0,Ba.default)("1234")];case 2:return a=t.sent(),[4,Pa.default.saveAdmin({email:"admin@email.com",fullname:"admin",area:En.UserArea.admin,password:a,role:En.Roles.admin}).catch(function(){console.log("duplicated admin user")}).finally(function(){console.log("user admin created")})];case 3:return t.sent(),[4,(0,La.default)().catch(function(i){console.log(i),console.log("the first form is already created")})];case 4:return t.sent(),[2]}})})};Z.default=Ga});var ot=exports&&exports.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(exports,"__esModule",{value:!0});var Va=ot(yn()),Wa=ot(P()),Sn=ot($()),Ja=ot(pn());(0,Ja.default)().then(function(){console.log("connecting database...")});Wa.default.connect();Va.default.listen(Sn.default.PORT,function(){console.log("the server has started in port ".concat(Sn.default.PORT))});
