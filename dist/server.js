"use strict";var d=(u,a)=>()=>(a||u((a={exports:{}}).exports,a),a.exports);var N=d(Q=>{"use strict";var yr=Q&&Q.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();Object.defineProperty(Q,"__esModule",{value:!0});var wr=function(u){yr(a,u);function a(t){var i=u.call(this)||this;return i.isOperational=!0,i.message=t.message,i.statusCode=t.statusCode,i.errorCode=t.errorCode,i}return a}(Error);Q.default=wr});var B=d(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});var br={DATABASE_HOST:process.env.DATABASE_HOST,DATABASE_PASSWORD:process.env.DATABASE_PASSWORD,DATABASE_NAME:process.env.DATABASE_NAME,DATABASE_USERNAME:process.env.DATABASE_USERNAME,MODE:process.env.MODE,SECRET:process.env.SECRET,EMAIL_RESEND_TOKEN:process.env.EMAIL_RESEND_TOKEN,EMAIL_RESEND:process.env.EMAIL_RESEND,PORT:process.env.PORT,API_PREFIX:process.env.API_PREFIX,IP:process.env.IP};Te.default=br});var ft=d(k=>{"use strict";var mr=k&&k.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},gr=k&&k.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},ct=k&&k.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(k,"__esModule",{value:!0});var Er=ct(N()),pr=ct(B()),Sr=function(u,a,t,i){return mr(void 0,void 0,void 0,function(){return gr(this,function(n){return Array.isArray(u)?(console.log(u),t.status(400).json({message:"the body is not correct",errors:u}),[2]):u instanceof Er.default?(u.isOperational=void 0,t.status(u.statusCode).json({error:u}),[2]):u instanceof Error?(t.status(400).json({message:u.message,error:pr.default.MODE==="prod"?void 0:u}),[2]):(t.status(400).json({message:"error"}),[2])})})};k.default=Sr});var L=d(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});var Or={USER_EMAIL_NOT_FOUND:{errorCode:"1001",statusCode:404,message:"email not found"},INCORRECT_PASSWORD:{errorCode:"1002",statusCode:400,message:"the provided password is incorrect"},USER_NOT_FOUND:{errorCode:"1003",statusCode:404,message:"user not found"},USER_DOES_NOT_HAVE_ACCESS:{errorCode:"1004",statusCode:401,message:"you can't still login, you need admin permission"},EMAIL_ALREADY_EXISTS:{errorCode:"1004",statusCode:400,message:"the provided email already exists"},JWT_NOT_PROVIDED:{errorCode:"2001",statusCode:400,message:"please, login"},UNAUTHORIZED:{errorCode:"2002",statusCode:401,message:"unauthorized access"},JWT_IS_EXPIRED:{errorCode:"2003",statusCode:400,message:"the provided jwt is expired, login again"}};Ae.default=Or});var H=d($=>{"use strict";var dt=$&&$.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty($,"__esModule",{value:!0});var kr=dt(require("mysql2/promise")),oe=dt(B()),Tr=kr.default.createPool({database:oe.default.DATABASE_NAME,user:oe.default.DATABASE_USERNAME,host:oe.default.DATABASE_HOST,password:oe.default.DATABASE_PASSWORD,waitForConnections:!0,connectionLimit:10,queueLimit:1,nestTables:!0});$.default=Tr});var ce=d(P=>{"use strict";var se=P&&P.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},le=P&&P.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(P,"__esModule",{value:!0});var Ar=function(){function u(){}return u.prototype.findAll=function(){return se(this,void 0,void 0,function(){return le(this,function(a){throw new Error("method not implemented")})})},u.prototype.findById=function(a){return se(this,void 0,void 0,function(){return le(this,function(t){throw new Error("method not implemented")})})},u.prototype.save=function(a){return se(this,void 0,void 0,function(){return le(this,function(t){throw new Error("method not implemented")})})},u.prototype.update=function(a){return se(this,void 0,void 0,function(){return le(this,function(t){throw new Error("method not implemented")})})},u}();P.default=Ar});var De=d(y=>{"use strict";var qr=y&&y.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),qe=y&&y.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Re=y&&y.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Rr=y&&y.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(y,"__esModule",{value:!0});y.UserRepository=void 0;var Dr=Rr(ce()),jr=function(u){qr(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findByEmail=function(t){return qe(this,void 0,void 0,function(){return Re(this,function(i){throw new Error("method not implemented")})})},a.prototype.saveAdmin=function(t){return qe(this,void 0,void 0,function(){return Re(this,function(i){throw new Error("method not implemented")})})},a.prototype.toggleAccessUser=function(t,i){return qe(this,void 0,void 0,function(){return Re(this,function(n){throw new Error("method not implemented")})})},a}(Dr.default);y.UserRepository=jr});var ht=d(b=>{"use strict";var Mr=b&&b.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),G=b&&b.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},W=b&&b.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Cr=b&&b.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(b,"__esModule",{value:!0});var V=Cr(H()),Ir=De(),Ur=function(u){Mr(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return G(this,void 0,void 0,function(){var t;return W(this,function(i){switch(i.label){case 0:return[4,V.default.query("SELECT * FROM users")];case 1:return t=i.sent()[0],[2,t]}})})},a.prototype.findById=function(t){return G(this,void 0,void 0,function(){var i;return W(this,function(n){switch(n.label){case 0:return[4,V.default.query("SELECT * FROM users WHERE id = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.save=function(t){return G(this,void 0,void 0,function(){var i;return W(this,function(n){switch(n.label){case 0:return[4,V.default.query("INSERT INTO users (email, fullname, password, area, has_access, role) VALUES (?, ?, ?, ?, ?, ?)",[t.email,t.fullname,t.password,t.area,0,t.role])];case 1:return i=n.sent()[0],[2,{id:i.insertId,fullname:t.fullname,email:t.email,password:t.password,area:t.area}]}})})},a.prototype.findByEmail=function(t){return G(this,void 0,void 0,function(){var i;return W(this,function(n){switch(n.label){case 0:return[4,V.default.query("SELECT * FROM users WHERE email = ?",[t])];case 1:return i=n.sent()[0][0],[2,i]}})})},a.prototype.saveAdmin=function(t){return G(this,void 0,void 0,function(){var i;return W(this,function(n){switch(n.label){case 0:return[4,V.default.query("INSERT INTO users (email, fullname, password, area, has_access, role) VALUES (?, ?, ?, ?, ?, ?)",[t.email,t.fullname,t.password,t.area,1,t.role])];case 1:return i=n.sent()[0],[2,{id:i.insertId,fullname:t.fullname,email:t.email,password:t.password,area:t.area}]}})})},a.prototype.toggleAccessUser=function(t,i){return G(this,void 0,void 0,function(){var n;return W(this,function(e){switch(e.label){case 0:return[4,V.default.query("UPDATE users SET has_access = ? WHERE id = ?",[Number(t),i])];case 1:return n=e.sent()[0],[2,{id:n.insertId}]}})})},a}(Ir.UserRepository);b.default=Ur});var F=d(m=>{"use strict";var Nr=m&&m.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),J=m&&m.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},X=m&&m.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ce=m&&m.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(m,"__esModule",{value:!0});var je=Ce(L()),Pr=Ce(ht()),Fr=De(),Me=Ce(N()),Br=function(u){Nr(a,u);function a(t){var i=u.call(this)||this;return i.userRepository=t,i}return a.prototype.findAll=function(){return J(this,void 0,void 0,function(){var t;return X(this,function(i){switch(i.label){case 0:return[4,this.userRepository.findAll()];case 1:return t=i.sent(),[2,t.map(function(n){return n.password=void 0,n})]}})})},a.prototype.save=function(t){return J(this,void 0,void 0,function(){return X(this,function(i){return[2,this.userRepository.save(t).catch(function(n){if(n.code==="ER_DUP_ENTRY")throw new Me.default(je.default.EMAIL_ALREADY_EXISTS);return n})]})})},a.prototype.saveAdmin=function(t){return J(this,void 0,void 0,function(){return X(this,function(i){return[2,this.userRepository.saveAdmin(t)]})})},a.prototype.findByEmail=function(t){return J(this,void 0,void 0,function(){var i;return X(this,function(n){switch(n.label){case 0:return[4,this.userRepository.findByEmail(t)];case 1:if(i=n.sent(),!i)throw new Me.default(je.default.USER_EMAIL_NOT_FOUND);return[2,i]}})})},a.prototype.findById=function(t){return J(this,void 0,void 0,function(){var i;return X(this,function(n){switch(n.label){case 0:return[4,this.userRepository.findById(t)];case 1:if(i=n.sent(),!i)throw new Me.default(je.default.USER_NOT_FOUND);return[2,i]}})})},a.prototype.toggleAccessUser=function(t,i){return J(this,void 0,void 0,function(){return X(this,function(n){return[2,this.userRepository.toggleAccessUser(t,i)]})})},a}(Fr.UserRepository),Lr=new Br(new Pr.default);m.default=Lr});var Y=d(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});var Hr=require("express-validator"),Gr=function(u){return function(a,t,i){var n=(0,Hr.validationResult)(a);if(!n.isEmpty())return i(n.array());u(a,t,i).catch(function(e){i(e)})}};Ie.default=Gr});var vt=d(T=>{"use strict";var fe=T&&T.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},de=T&&T.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},_t=T&&T.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(T,"__esModule",{value:!0});var he=_t(F()),_e=_t(Y()),Wr=function(){function u(){var a=this;this.findAll=(0,_e.default)(function(t,i){return fe(a,void 0,void 0,function(){var n;return de(this,function(e){switch(e.label){case 0:return[4,he.default.findAll()];case 1:return n=e.sent(),i.status(200).json({users:n.filter(function(o){return o.has_access})}),[2]}})})}),this.findAllNotifications=(0,_e.default)(function(t,i){return fe(a,void 0,void 0,function(){var n;return de(this,function(e){switch(e.label){case 0:return[4,he.default.findAll()];case 1:return n=e.sent(),i.status(200).json({users:n.filter(function(o){return!o.has_access})}),[2]}})})}),this.save=(0,_e.default)(function(t,i){return fe(a,void 0,void 0,function(){var n;return de(this,function(e){switch(e.label){case 0:return[4,he.default.save(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"user created successfully",user:n}),[2]}})})}),this.toggleAccessUser=(0,_e.default)(function(t,i){return fe(a,void 0,void 0,function(){var n,e,o;return de(this,function(l){switch(l.label){case 0:return n=t.body,e=n.userId,o=n.access,[4,he.default.toggleAccessUser(o,e)];case 1:return l.sent(),i.status(200).json({message:"updated user successfully"}),[2]}})})})}return u}(),Vr=new Wr;T.default=Vr});var Ne=d(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});var Jr={JWT_AUTH:"ola_auth_jwt"};Ue.default=Jr});var Be=d(_=>{"use strict";var Pe=_&&_.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Fe=_&&_.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},yt=_&&_.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(_,"__esModule",{value:!0});_.verifyTokenUser=_.verifyToken=_.createToken=void 0;var wt=yt(require("jsonwebtoken")),ve=yt(B());function Xr(u){return Pe(this,void 0,void 0,function(){return Fe(this,function(a){if(!ve.default.SECRET)throw new Error("secret not provided");return[2,wt.default.sign(u,ve.default.SECRET,{expiresIn:"1d"})]})})}_.createToken=Xr;function bt(u){return Pe(this,void 0,void 0,function(){return Fe(this,function(a){if(!ve.default.SECRET)throw new Error("secret not provided");return[2,wt.default.verify(u,ve.default.SECRET)]})})}_.verifyToken=bt;function Yr(u){return Pe(this,void 0,void 0,function(){var a;return Fe(this,function(t){switch(t.label){case 0:return[4,bt(u)];case 1:return a=t.sent(),[2,a]}})})}_.verifyTokenUser=Yr});var ye=d(A=>{"use strict";var Kr=A&&A.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Zr=A&&A.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},x=A&&A.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(A,"__esModule",{value:!0});var zr=x(L()),Qr=x(Ne()),$r=x(F()),xr=x(Y()),en=x(N()),tn=Be(),rn=(0,xr.default)(function(u,a,t){return Kr(void 0,void 0,void 0,function(){var i,n,e;return Zr(this,function(o){switch(o.label){case 0:if(i=(e=u.cookies)===null||e===void 0?void 0:e[Qr.default.JWT_AUTH],!i)throw new en.default(zr.default.JWT_NOT_PROVIDED);return[4,(0,tn.verifyTokenUser)(i)];case 1:return n=o.sent(),[4,$r.default.findById(n.id)];case 2:return o.sent(),u.cookieJwt=i,u.decodedToken=n,t(),[2]}})})});A.default=rn});var Le=d(q=>{"use strict";var nn=q&&q.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},un=q&&q.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},we=q&&q.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(q,"__esModule",{value:!0});var an=we(L()),on=we(F()),sn=we(Y()),ln=we(N());function cn(u){var a=this;return(0,sn.default)(function(t,i,n){return nn(a,void 0,void 0,function(){var e,o;return un(this,function(l){switch(l.label){case 0:return e=t.decodedToken,[4,on.default.findById(e?.id)];case 1:if(o=l.sent(),!u.includes(o?.role))throw new ln.default(an.default.UNAUTHORIZED);return n(),[2]}})})})}q.default=cn});var Z=d(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.Roles=K.UserArea=void 0;var mt;(function(u){u.admin="admin",u.commercial="Asesor comercial",u.design="Dise\xF1o",u.communityManager="Community manager",u.photograph="Fot\xF3grafo",u.telemarketing="Telemarketing",u.secretary="secretar\xEDa"})(mt||(K.UserArea=mt={}));var gt;(function(u){u.admin="admin",u.user="user"})(gt||(K.Roles=gt={}))});var pt=d(ee=>{"use strict";var He=ee&&ee.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ee,"__esModule",{value:!0});var fn=require("express"),Ge=He(vt()),We=He(ye()),Ve=He(Le()),Je=Z(),Et=require("express-validator"),be=(0,fn.Router)();be.route("/").get(We.default,(0,Ve.default)([Je.Roles.admin]),Ge.default.findAll);be.route("/notifications").get(We.default,(0,Ve.default)([Je.Roles.admin]),Ge.default.findAllNotifications);be.route("/toggle-access").post([(0,Et.body)("userId").isNumeric(),(0,Et.body)("access").isBoolean()],We.default,(0,Ve.default)([Je.Roles.admin]),Ge.default.toggleAccessUser);ee.default=be});var Ye=d(g=>{"use strict";var St=g&&g.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Ot=g&&g.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(g,"__esModule",{value:!0});g.crypPassword=g.comparePassword=void 0;var Xe=require("bcrypt");function dn(u,a){return St(this,void 0,void 0,function(){return Ot(this,function(t){return[2,(0,Xe.compare)(u,a)]})})}g.comparePassword=dn;function kt(u){return St(this,void 0,void 0,function(){var a;return Ot(this,function(t){switch(t.label){case 0:return[4,(0,Xe.genSalt)()];case 1:return a=t.sent(),[2,(0,Xe.hash)(u,a)]}})})}g.crypPassword=kt;g.default=kt});var Ke=d(E=>{"use strict";var hn=E&&E.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),_n=E&&E.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},vn=E&&E.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},yn=E&&E.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(E,"__esModule",{value:!0});var wn=yn(ce()),bn=function(u){hn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.find=function(t){return _n(this,void 0,void 0,function(){return vn(this,function(i){throw new Error("method not implemented")})})},a}(wn.default);E.default=bn});var Dt=d(p=>{"use strict";var mn=p&&p.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Tt=p&&p.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},At=p&&p.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Rt=p&&p.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(p,"__esModule",{value:!0});var qt=Rt(H()),gn=Rt(Ke()),En=function(u){mn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.save=function(t){return Tt(this,void 0,void 0,function(){var i;return At(this,function(n){switch(n.label){case 0:return[4,qt.default.query("INSERT INTO blacklist (token, user_id) VALUES (?, ?)",[t.token,t.user_id])];case 1:return i=n.sent()[0],[2,{id:i.insertId,token:t.token}]}})})},a.prototype.find=function(t){return Tt(this,void 0,void 0,function(){var i;return At(this,function(n){switch(n.label){case 0:return[4,qt.default.query("SELECT * FROM blacklist WHERE user_id = ? AND token = ?",[t.user_id,t.token])];case 1:return i=n.sent()[0][0],[2,i]}})})},a}(gn.default);p.default=En});var It=d(S=>{"use strict";var pn=S&&S.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),jt=S&&S.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Mt=S&&S.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ct=S&&S.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(S,"__esModule",{value:!0});var Sn=Ct(Ke()),On=Ct(Dt()),kn=function(u){pn(a,u);function a(t){var i=u.call(this)||this;return i.blacklistRespository=t,i}return a.prototype.find=function(t){return jt(this,void 0,void 0,function(){var i;return Mt(this,function(n){return i=this.blacklistRespository.find(t),[2,i]})})},a.prototype.save=function(t){return jt(this,void 0,void 0,function(){return Mt(this,function(i){return[2,this.blacklistRespository.save(t)]})})},a}(Sn.default),Tn=new kn(new On.default);S.default=Tn});var Ft=d(h=>{"use strict";var An=h&&h.__createBinding||(Object.create?function(u,a,t,i){i===void 0&&(i=t);var n=Object.getOwnPropertyDescriptor(a,t);(!n||("get"in n?!a.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return a[t]}}),Object.defineProperty(u,i,n)}:function(u,a,t,i){i===void 0&&(i=t),u[i]=a[t]}),qn=h&&h.__setModuleDefault||(Object.create?function(u,a){Object.defineProperty(u,"default",{enumerable:!0,value:a})}:function(u,a){u.default=a}),Rn=h&&h.__importStar||function(u){if(u&&u.__esModule)return u;var a={};if(u!=null)for(var t in u)t!=="default"&&Object.prototype.hasOwnProperty.call(u,t)&&An(a,u,t);return qn(a,u),a},Ze=h&&h.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},ze=h&&h.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},me=h&&h.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(h,"__esModule",{value:!0});var Qe=me(L()),Dn=Z(),Ut=Rn(Ye()),$e=me(N()),Nt=me(It()),Pt=me(F()),jn=function(){function u(){}return u.prototype.signup=function(a){return Ze(this,void 0,void 0,function(){var t,i;return ze(this,function(n){switch(n.label){case 0:return t=a,[4,(0,Ut.default)(a.password||"")];case 1:return t.password=n.sent(),a.role=Dn.Roles.user,[4,Pt.default.save(a)];case 2:return i=n.sent(),[2,i]}})})},u.prototype.login=function(a){return Ze(this,void 0,void 0,function(){var t,i;return ze(this,function(n){switch(n.label){case 0:return[4,Pt.default.findByEmail(a.email)];case 1:if(t=n.sent(),!t.has_access)throw new $e.default(Qe.default.USER_DOES_NOT_HAVE_ACCESS);return[4,(0,Ut.comparePassword)(a.password,t.password)];case 2:if(i=n.sent(),!i)throw new $e.default(Qe.default.INCORRECT_PASSWORD);return t.password=void 0,[2,t]}})})},u.prototype.logout=function(a){return Ze(this,void 0,void 0,function(){var t;return ze(this,function(i){switch(i.label){case 0:return[4,Nt.default.find({user_id:a.user_id,token:a.token})];case 1:if(t=i.sent(),t)throw new $e.default(Qe.default.JWT_IS_EXPIRED);return[4,Nt.default.save({user_id:a.user_id,token:a.token})];case 2:return i.sent(),[2]}})})},u}(),Mn=new jn;h.default=Mn});var Lt=d(w=>{"use strict";var Cn=w&&w.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},In=w&&w.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Un=w&&w.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(w,"__esModule",{value:!0});w.removeTokenCookie=w.createTokenCookie=void 0;var Bt=Un(Ne()),Nn=Be(),xe=new Date;xe.setDate(xe.getDate()+1);var Pn=new Date(0);function Fn(u,a){return Cn(this,void 0,void 0,function(){var t;return In(this,function(i){switch(i.label){case 0:return[4,(0,Nn.createToken)(a)];case 1:return t=i.sent(),u.cookie(Bt.default.JWT_AUTH,t,{httpOnly:!0,path:"/",expires:xe}),[2]}})})}w.createTokenCookie=Fn;function Bn(u){u.cookie(Bt.default.JWT_AUTH,"",{httpOnly:!0,path:"/",expires:Pn})}w.removeTokenCookie=Bn});var Ht=d(R=>{"use strict";var ge=R&&R.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Ee=R&&R.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},te=R&&R.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(R,"__esModule",{value:!0});var Ln=te(L()),et=te(Ft()),Hn=te(F()),pe=te(Y()),tt=Lt(),Gn=te(N()),Wn=function(){function u(){var a=this;this.signup=(0,pe.default)(function(t,i){return ge(a,void 0,void 0,function(){var n;return Ee(this,function(e){switch(e.label){case 0:return[4,et.default.signup(t.body)];case 1:return n=e.sent(),n.password=void 0,[4,(0,tt.createTokenCookie)(i,{id:n.id})];case 2:return e.sent(),i.status(200).json({message:"user created successfully",user:n}),[2]}})})}),this.login=(0,pe.default)(function(t,i){return ge(a,void 0,void 0,function(){var n;return Ee(this,function(e){switch(e.label){case 0:return[4,et.default.login(t.body)];case 1:return n=e.sent(),[4,(0,tt.createTokenCookie)(i,{id:n.id})];case 2:return e.sent(),i.status(200).json({messsage:"user authenticated!",user:n}),[2]}})})}),this.logout=(0,pe.default)(function(t,i){return ge(a,void 0,void 0,function(){var n,e;return Ee(this,function(o){switch(o.label){case 0:return n=t.cookieJwt,e=t.decodedToken,[4,et.default.logout({user_id:e.id,token:n})];case 1:return o.sent(),(0,tt.removeTokenCookie)(i),i.json({message:"you are logout!"}),[2]}})})}),this.athenticate=(0,pe.default)(function(t,i){return ge(a,void 0,void 0,function(){var n,e;return Ee(this,function(o){switch(o.label){case 0:return n=t.decodedToken,[4,Hn.default.findById(n.id)];case 1:if(e=o.sent(),!e.has_access)throw new Gn.default(Ln.default.USER_DOES_NOT_HAVE_ACCESS);return e.password=void 0,i.status(200).json({message:"user authenticated",user:e}),[2]}})})})}return u}(),Vn=new Wn;R.default=Vn});var Vt=d(re=>{"use strict";var Gt=re&&re.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(re,"__esModule",{value:!0});var Jn=require("express"),Se=Gt(Ht()),z=require("express-validator"),Xn=Z(),Wt=Gt(ye()),ne=(0,Jn.Router)();ne.route("/signup").post([(0,z.body)("fullname").isString(),(0,z.body)("email").isEmail(),(0,z.body)("password").isString(),(0,z.body)("area").isIn(Object.values(Xn.UserArea))],Se.default.signup);ne.route("/login").post([(0,z.body)("email").isEmail(),(0,z.body)("password").isString()],Se.default.login);ne.route("/me").get(Wt.default,Se.default.athenticate);ne.route("/logout").get(Wt.default,Se.default.logout);re.default=ne});var rt=d(U=>{"use strict";var Yn=U&&U.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Kn=U&&U.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(U,"__esModule",{value:!0});U.FormRepository=void 0;var Zn=Kn(ce()),zn=function(u){Yn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a}(Zn.default);U.FormRepository=zn});var Kt=d(v=>{"use strict";var Qn=v&&v.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ie=v&&v.__assign||function(){return ie=Object.assign||function(u){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(u[n]=a[n])}return u},ie.apply(this,arguments)},Jt=v&&v.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},Xt=v&&v.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},$n=v&&v.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(v,"__esModule",{value:!0});v.MysqlFormRepository=void 0;var Yt=$n(H()),xn=rt(),ei=function(u){Qn(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.findAll=function(){return Jt(this,void 0,void 0,function(){var t,i,n,e,o,l;return Xt(this,function(c){switch(c.label){case 0:return[4,Yt.default.query(`SELECT form.*, form_group.*, field.*
      FROM form 
      LEFT JOIN form_group ON form_group.id=form.id
      LEFT JOIN field ON field.form_group_id=form_group.id`)];case 1:for(t=c.sent()[0],i=[],n=function(r){var s=r.form_group,f=r.fields,st=r.form,lt=i.findIndex(function(vr){return vr.id===st.id});lt===-1?i.push(ie(ie({},st),{form_groups:[]})):i[lt].form_groups.push(ie({},s))},e=0,o=t;e<o.length;e++)l=o[e],n(l);return[2,i]}})})},a.prototype.save=function(t){return Jt(this,void 0,void 0,function(){var i;return Xt(this,function(n){switch(n.label){case 0:return[4,Yt.default.query("INSERT INTO form (label) VALUES (?)",[t.label])];case 1:return i=n.sent()[0],[2,{id:i.insertId,label:t.label}]}})})},a}(xn.FormRepository);v.MysqlFormRepository=ei});var Qt=d(D=>{"use strict";var ti=D&&D.__extends||function(){var u=function(a,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(i[e]=n[e])},u(a,t)};return function(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");u(a,t);function i(){this.constructor=a}a.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Zt=D&&D.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},zt=D&&D.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(D,"__esModule",{value:!0});var ri=rt(),ni=Kt(),ii=function(u){ti(a,u);function a(t){var i=u.call(this)||this;return i.formRepository=t,i}return a.prototype.findAll=function(){return Zt(this,void 0,void 0,function(){return zt(this,function(t){return[2,this.formRepository.findAll()]})})},a.prototype.save=function(t){return Zt(this,void 0,void 0,function(){return zt(this,function(i){return[2,this.formRepository.save(t)]})})},a}(ri.FormRepository),ui=new ii(new ni.MysqlFormRepository);D.default=ui});var nr=d(j=>{"use strict";var $t=j&&j.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},xt=j&&j.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},rr=j&&j.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(j,"__esModule",{value:!0});var er=rr(Qt()),tr=rr(Y()),ai=function(){function u(){var a=this;this.findAll=(0,tr.default)(function(t,i){return $t(a,void 0,void 0,function(){var n;return xt(this,function(e){switch(e.label){case 0:return[4,er.default.findAll()];case 1:return n=e.sent(),i.status(200).json({forms:n}),[2]}})})}),this.save=(0,tr.default)(function(t,i){return $t(a,void 0,void 0,function(){var n;return xt(this,function(e){switch(e.label){case 0:return[4,er.default.save(t.body)];case 1:return n=e.sent(),i.status(200).json({message:"form created successfully",form:n}),[2]}})})})}return u}(),oi=new ai;j.default=oi});var ar=d(ue=>{"use strict";var nt=ue&&ue.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ue,"__esModule",{value:!0});var si=require("express"),ir=nt(ye()),ur=nt(nr()),li=require("express-validator"),ci=nt(Le()),fi=Z(),it=(0,si.Router)();it.route("/").get(ir.default,ur.default.findAll);it.route("/").post(ir.default,(0,ci.default)([fi.Roles.admin]),[(0,li.body)("label").isString().withMessage("label is required")],ur.default.save);ue.default=it});var or=d(ae=>{"use strict";var M=ae&&ae.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(ae,"__esModule",{value:!0});var ut=M(require("express")),di=M(require("path")),hi=M(require("cookie-parser")),_i=M(require("cors")),vi=M(ft()),at=M(B()),yi=M(pt()),wi=M(Vt()),bi=M(ar()),O=(0,ut.default)();O.use(ut.default.json());O.use((0,hi.default)());O.use((0,_i.default)({origin:["http://localhost:4000","http://localhost:5173"],credentials:!0}));O.get("/health",function(u,a){a.status(200).json({message:"Success!"})});O.use("/",ut.default.static(di.default.resolve(__dirname,"static","dist")));O.use("".concat(at.default.API_PREFIX,"/users"),yi.default);O.use("".concat(at.default.API_PREFIX,"/"),wi.default);O.use("".concat(at.default.API_PREFIX,"/forms"),bi.default);O.use("*",function(u,a){a.status(404).json({message:"route not found"})});O.use(vi.default);ae.default=O});var sr=d(C=>{"use strict";var mi=C&&C.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},gi=C&&C.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},Ei=C&&C.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(C,"__esModule",{value:!0});var Oe=Ei(H()),pi=function(){return mi(void 0,void 0,void 0,function(){return gi(this,function(u){switch(u.label){case 0:return[4,Oe.default.query('INSERT INTO form (label, id) VALUES ("Formulario Ola", 1)')];case 1:return u.sent(),[4,Oe.default.query('INSERT INTO form_group (label, form_id) VALUES ("Informaci\xF3n referencial", 1)')];case 2:return u.sent(),[4,Oe.default.query(`INSERT INTO field (label, component, form_group_id, metadata)
     VALUES ("Ciudad", "input", 1,  '{"type": "text"}')`)];case 3:return u.sent(),[4,Oe.default.query(`INSERT INTO field (label, component, form_group_id, metadata)
     VALUES ("Fecha", "input", 1,  '{"type": "date"}')`)];case 4:return u.sent(),[2]}})})};C.default=pi});var hr=d(I=>{"use strict";var lr=I&&I.__awaiter||function(u,a,t,i){function n(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function l(s){try{r(i.next(s))}catch(f){o(f)}}function c(s){try{r(i.throw(s))}catch(f){o(f)}}function r(s){s.done?e(s.value):n(s.value).then(l,c)}r((i=i.apply(u,a||[])).next())})},cr=I&&I.__generator||function(u,a){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(r){return function(s){return c([r,s])}}function c(r){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(t=0)),t;)try{if(i=1,n&&(e=r[0]&2?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return t.label++,{value:r[1],done:!1};case 5:t.label++,n=r[1],r=[0];continue;case 7:r=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){t=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){t.label=r[1];break}if(r[0]===6&&t.label<e[1]){t.label=e[1],e=r;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(r);break}e[2]&&t.ops.pop(),t.trys.pop();continue}r=a.call(u,t)}catch(s){r=[6,s],n=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},ke=I&&I.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(I,"__esModule",{value:!0});var fr=require("fs/promises"),Si=ke(H()),Oi=ke(F()),dr=Z(),ki=ke(Ye()),Ti=ke(sr()),Ai=function(){return lr(void 0,void 0,void 0,function(){var u,a;return cr(this,function(t){switch(t.label){case 0:return[4,(0,fr.readdir)(__dirname)];case 1:return u=t.sent(),u.forEach(function(i){return lr(void 0,void 0,void 0,function(){var n;return cr(this,function(e){switch(e.label){case 0:return i==="db.ts"||i==="db.js"?[2]:[4,(0,fr.readFile)("".concat(__dirname,"/").concat(i),{encoding:"utf-8"})];case 1:return n=e.sent(),[4,Si.default.query(n).catch(function(o){console.log(o.message)})];case 2:return e.sent(),[2]}})})}),[4,(0,ki.default)("1234")];case 2:return a=t.sent(),[4,Oi.default.saveAdmin({email:"admin@email.com",fullname:"admin",area:dr.UserArea.admin,password:a,role:dr.Roles.admin}).catch(function(){console.log("duplicated admin user")}).finally(function(){console.log("user admin created")})];case 3:return t.sent(),[4,(0,Ti.default)().catch(function(){console.log("the first form is already created")})];case 4:return t.sent(),[2]}})})};I.default=Ai});var ot=exports&&exports.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(exports,"__esModule",{value:!0});var qi=ot(or()),_r=ot(B()),Ri=ot(hr());(0,Ri.default)().then(function(){console.log("connecting database...")});qi.default.listen(_r.default.PORT,function(){console.log("the server has started in port ".concat(_r.default.PORT))});
